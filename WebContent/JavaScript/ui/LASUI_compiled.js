function LASUI(){this.refs={plot:{},DW:{widgetType:null},DepthWidget:{widgetType:null},analysis:{enabled:false},options:{plot:{},download:{},external:{}},operations:{plot:{},download:{},external:{}}};this.hrefs={getProduct:{url:"ProductServer.do"},getCategories:{url:"getCategories.do"},getDataConstraints:{url:"getDataConstraints.do"},getGrid:{url:"getGrid.do"},getViews:{url:"getViews.do"},getOperations:{url:"getOperations.do"},getOptions:{url:"getOptions.do"},getMetadata:{url:"getMetadata.do"}};this.state=
{dataset:null,datasets:{},operation:{plot:null,download:null,external:null},properties:{plot:[],download:[],external:[]},optiondefs:{plot:"",download:"",external:""},newproperties:{plot:[],download:[],external:[]},view:{plot:null,download:null,external:null,widgets:null},embed:true,xybox:{},categorynames:[],analysis:{type:null,axes:{}},selection:{x:{},y:{},z:{},t:{}}};this.anchors={tree:"tree",output:"output",map:"MapWidget",date:"date",depth:"depth",header:"header",breadcrumb:"breadcrumb",variables:"variables",
inputs:{maxX:"input_maxX",maxY:"input_maxY",minX:"input_minX",minY:"input_minY"},analysis:"analysis"};this.AJAX_cache={};this.request=new LASRequest;this.autoupdate=false;for(var f in this)if(typeof this[f]=="function")this[f].LASBind=function(object){var __method=this;var args=[];for(var i=0,length=arguments.length;i<length;i++)args.push(arguments[i]);var object=args.shift();return function(event){return __method.apply(object,[event||window.event].concat(args))}}}
LASUI.prototype.initUI=function(anchorId){if((this.params.dsid||this.params.catid)&&this.params.varid){this.state.dataset=this.params.dsid;this.state.catid=this.params.catid;this.state.lastDataset="";this.state.lastVariable="";this.state.variable=this.params.varid;this.state.operation.plot=this.params.plot;this.state.view.plot=this.params.view;this.autoupdate=this.params.autoupdate;if((this.state.dataset!=""||this.params.catid!="")&&this.state.variable!=""){this.submitOnLoad=true;document.getElementById("ol_map_widget").onmouseover=
null}else this.submitOnLoad=false}else this.submitOnLoad=false;this.state.xybox={};this.fullXYExtent=true;this.UIMask=document.createElement("DIV");this.UIMask.className="LASUIMask";this.toggleUIMask("none");document.body.appendChild(this.UIMask);this.firstload=true;this.expired=false;this.refs.operations.plot.DOMNode=document.getElementById("plotType");this.refs.operations.download.DOMNode=document.getElementById("downloadType");this.refs.options.plot.DOMNode=document.getElementById("plotOptions");
this.refs.options.download.DOMNode=document.getElementById("downloadOptions");this.refs.options.external.DOMNode=document.getElementById("externalOptions");this.refs.analysis.type={op:document.getElementById("analysis_op"),axes:document.getElementById("analysis_axes")};this.refs.analysis.axes={xy:document.getElementById("xy_analysis"),x:document.getElementById("x_analysis"),y:document.getElementById("y_analysis"),z:document.getElementById("z_analysis"),t:document.getElementById("t_analysis")};this.refs.analysis.type.axes.onchange=
this.selectAnalysisAxis.LASBind(this,null,true);this.refs.analysis.type.op.onchange=this.selectAnalysisType.LASBind(this);if(document.getElementById(this.anchors.output).addEventListener&&!document.all)document.getElementById(this.anchors.output).addEventListener("load",this.onPlotLoad.LASBind(this),true);else if(document.getElementById(this.anchors.output).attachEvent&&!document.all)document.getElementById(this.anchors.output).addEventListener("load",this.onPlotLoad.LASBind(this));else if(document.all)document.getElementById(this.anchors.output).onreadystatechange=
this.onPlotLoad.LASBind(this);else document.getElementById(this.anchors.output).onload=this.onPlotLoad.LASBind(this);this.refs.inputs={};for(var i in this.anchors.inputs)this.refs.inputs[i]=document.getElementById(this.anchors.inputs[i]);if(document.getElementById("categories")){this.refs.categories={};this.refs.categories.LINode=document.getElementById("categories");var cancel=document.createElement("INPUT");cancel.type="submit";cancel.value="Close";cancel.className="LASSubmitInputNode";cancel.onclick=
this.genericHandler.LASBind(this,"this.hideCategories()");this.refs.categories.LINode.appendChild(cancel);this.refs.categories.LINode.appendChild(document.createElement("BR"));this.refs.categories.title=document.createElement("SPAN");this.refs.categories.title.appendChild(document.createTextNode("Select a dataset category."));this.refs.categories.title.className="LASTreeTitleNode";this.refs.categories.ULNode=document.createElement("UL");this.refs.categories.ULNode.className="LASTreeULNode";this.refs.categories.LINode.appendChild(this.refs.categories.title);
this.refs.categories.LINode.appendChild(this.refs.categories.ULNode);this.refs.categories.isExpanded=true;if(!document.all)var req=new XMLHttpRequest(this);else var req=new ActiveXObject("Microsoft.XMLHTTP");req.onreadystatechange=this.AJAXhandler.LASBind(this,req,"this.AJAX_cache['"+escape(this.hrefs.getCategories.url)+"']=req.responseText;this.setCategoryTreeNode(req.responseText,this.refs.categories,'categories');");this.AJAX_cache[this.hrefs.getCategories.url]="waiting";req.open("GET",this.hrefs.getCategories.url);
req.send(null)}if((this.state.dataset!=""||this.params.catid!="")&&this.state.variable!=""){if(this.params.catid)var catid=this.params.catid;else var catid=this.state.dataset;if(!document.all)var req=new XMLHttpRequest(this);else var req=new ActiveXObject("Microsoft.XMLHTTP");req.onreadystatechange=this.AJAXhandler.LASBind(this,req,"this.setInitialVariable(req.responseText);");req.open("GET",this.hrefs.getCategories.url+"?catid="+catid);req.send(null)}};
LASUI.prototype.setInitialVariable=function(strJson){var response=eval("("+strJson+")");if(response.categories)if(response.categories.status)if(response.categories.status=="ok"){var category=new LASGetCategoriesResponse(response);this.state.dataset=category.getDatasetID(0);this.state.datasets[this.state.dataset]=category;this.getGrid(this.state.dataset,this.state.variable);this.getDataConstraints(this.state.dataset,this.state.variable);var info=document.createElement("IMG");info.onclick=this.getMetadata.LASBind(this);
info.src="images/icon_info.gif";var varlist=document.createElement("SELECT");varlist.id="variables";if(document.getElementById(this.anchors.breadcrumb)){while(document.getElementById(this.anchors.breadcrumb).firstChild)document.getElementById(this.anchors.breadcrumb).removeChild(document.getElementById(this.anchors.breadcrumb).firstChild);document.getElementById(this.anchors.breadcrumb).appendChild(info);document.getElementById(this.anchors.breadcrumb).appendChild(document.createTextNode(category.getDatasetName()));
document.getElementById(this.anchors.breadcrumb).appendChild(varlist)}document.getElementById(this.anchors.variables).onchange=function(evt){this.options[this.selectedIndex].onselect({target:{selected:true}})};for(var i=0;i<category.getCategorySize();i++){if(this.state.variable==category.getChildID(i))var selected=true;else var selected=false;var OPTIONNode=new Option(category.getChildName(i),category.getChildID(i),false,selected);OPTIONNode.onselect=this.setVariable.LASBind(this,{category:category},
i,true);OPTIONNode.id="OPTION_"+category.getChildID(i);document.getElementById(this.anchors.variables).options[document.getElementById(this.anchors.variables).length]=OPTIONNode}var varObj=this.state.datasets[this.state.dataset].getChildByID(this.state.variable);if(varObj)if(varObj.grid_type!="scattered"){if(this.refs.analysis.enabled){this.hideAnalysis();this.showAnalysis()}document.getElementById("analysisWrapper").style.display=""}else{document.getElementById("analysisWrapper").style.display="none";
this.refs.analysis.enabled=false}}};LASUI.prototype.getMetadata=function(evt){window.open(this.hrefs.getMetadata.url+"?dsid="+this.state.dataset)};LASUI.prototype.hideCategories=function(){this.refs.categories.LINode.style.display="none";this.toggleUIMask("none")};LASUI.prototype.toggleUIMask=function(display){this.UIMask.style.height=document.body.offsetHeight+100+"px";this.UIMask.style.width=document.body.offsetWidth+30+"px";this.UIMask.style.display=display};
LASUI.prototype.AJAXhandler=function(app){var args=arguments;var req=args[1];var callback=args[2];if(req.readyState==4&&req.status==200)eval(callback)};LASUI.prototype.setCategoryTreeNode=function(strJson,node,id){var response=eval("("+strJson+")");node.category=new LASGetCategoriesResponse(response);if(node.category.getCategoryType()=="category")node.children=[];for(var i=0;i<node.category.getCategorySize();i++)this.setCategoryTreeSubNode(node,i,id);this.expand(node)};
LASUI.prototype.showInfo=function(evt){var args=arguments;var node=args[1];var i=args[2];if(node.category)if(node.category.getChildID(i))if(node.category.getChildChildrenType(i)=="variables")window.open(this.hrefs.getMetadata.url+"?dsid="+node.category.getChildID(i));else window.open(this.hrefs.getMetadata.url+"?catid="+node.category.getChildID(i))};
LASUI.prototype.setCategoryTreeSubNode=function(node,i,id){switch(node.category.getCategoryType()){case "category":this.createCategoryTreeNode(node,i,id);break;case "dataset":this.createVariableTreeNode(node,i);break}};
LASUI.prototype.createCategoryTreeNode=function(node,i,id){if(node==this.refs.categories&&node.category.getChildChildrenType(i)=="variables")this.refs.categories.title.innerHTML="Datasets";node.children[i]={};node.children[i].LINode=document.createElement("LI");node.children[i].LINode.className="LASTreeLINode";node.children[i].IMGNode=document.createElement("IMG");node.children[i].IMGNode.onclick=this.selectCategory.LASBind(this,node,i);node.children[i].IMGNode.src="JavaScript/ui/plus.gif";node.children[i].IMGNode.className=
"LASCategoryIMGNode";node.children[i].isExpanded=false;node.children[i].ULNode=document.createElement("ul");var table=document.createElement("TABLE");table.className="LASTreeTableNode";table.width="100%";var tbody=document.createElement("TBODY");tbody.style.padding=0;tbody.style.margin=0;var tr=document.createElement("TR");tr.style.padding=0;tr.style.margin=0;var td1=document.createElement("TD");td1.style.verticalAlign="top";td1.width="12px";td1.appendChild(node.children[i].IMGNode);td1.className=
"LASTreeTableCell";var td2=document.createElement("TD");td2.style.verticalAlign="top";td2.onclick=this.selectCategory.LASBind(this,node,i);td2.appendChild(document.createTextNode(node.category.getChildName(i)));td2.className="LASTreeTableCell";td2.style.textAlign="left";tr.appendChild(td1);tr.appendChild(td2);if(node.category.getChildChildrenType(i)=="variables"){var td3=document.createElement("TD");node.children[i].A=document.createElement("A");var img=document.createElement("img");img.src="images/icon_info.gif";
node.children[i].A.appendChild(img);node.children[i].A.onclick=this.showInfo.LASBind(this,node,i);td3.appendChild(node.children[i].A);td3.className="LASTreeTableCell";td3.width="12pt";tr.appendChild(td3)}tbody.appendChild(tr);table.appendChild(tbody);node.children[i].LINode.appendChild(table);node.children[i].LINode.appendChild(node.children[i].ULNode);if(node.category.getChildChildrenType(i)=="variables"&&node.category.getChild(i).children_dsid||node.category.getChildChildrenType(i)!="variables")node.ULNode.appendChild(node.children[i].LINode);
if(this.refs.categories[node.category.getChild(i).ID]||node.category.getChild(i).ID==this.state.dataset)this.selectCategory(null,node,i)};
LASUI.prototype.createVariableOptionNode=function(node,i){document.getElementById(this.anchors.variables).onchange=function(evt){this.options[this.selectedIndex].onselect({target:{selected:true}})};if(this.state.variable==node.category.getChildID(i))var selected=true;else var selected=false;var OPTIONNode=new Option(node.category.getChildName(i),node.category.getChildID(i),false,selected);OPTIONNode.onselect=this.setVariable.LASBind(this,node,i,true);OPTIONNode.id="OPTION_"+node.category.getChildID(i);
document.getElementById(this.anchors.variables).options[document.getElementById(this.anchors.variables).length]=OPTIONNode};
LASUI.prototype.createVariableTreeNode=function(node,i){if(!node.children)node.children=[];if(!node.children[i])node.children[i]={};node.children[i].LINode=document.createElement("LI");node.children[i].LINode.style.listStyleType="none";node.children[i].LINode.style.listStyleImage="none";node.children[i].LINode.className="LASTreeLINode";node.marginLeft="5pt";if(document.all){var elem_nm="<INPUT NAME='"+node.category.getDatasetID(i)+"'>";node.children[i].INPUTNode=document.createElement(elem_nm)}else{node.children[i].INPUTNode=
document.createElement("INPUT");node.children[i].INPUTNode.name=node.category.getDatasetID(i)}node.children[i].INPUTNode.type="radio";node.children[i].className="LASRadioInputNode";node.children[i].INPUTNode.onclick=this.setVariable.LASBind(this,node,i);node.children[i].INPUTNode.id=node.category.getChildID(i);var table=document.createElement("TABLE");table.width="100%";var tbody=document.createElement("TBODY");var tr=document.createElement("TR");var td1=document.createElement("TD");td1.appendChild(node.children[i].INPUTNode);
td1.className="LASTreeTableCell";td1.width="12pt";var td2=document.createElement("TD");td2.innerHTML=node.category.getChildName(i);td2.align="left";td2.className="LASTreeTableCell";tr.appendChild(td1);tr.appendChild(td2);tbody.appendChild(tr);table.appendChild(tbody);node.children[i].LINode.appendChild(table);if(this.state.variable==node.category.getChildID(i))node.children[i].INPUTNode.checked=true;node.ULNode.appendChild(node.children[i].LINode)};
LASUI.prototype.getCategory=function(parentNode,i){if(!parentNode.children[i].category){if(!document.all)var req=new XMLHttpRequest(this);else var req=new ActiveXObject("Microsoft.XMLHTTP");req.onreadystatechange=this.AJAXhandler.LASBind(this,req,"this.setCategoryTreeNode(req.responseText,args[3].children[args[4]],args[3].category.getChild(args[4]));",parentNode,i);req.open("GET",this.hrefs.getCategories.url+"?catid="+parentNode.category.getChildID(i));req.send(null)}};
LASUI.prototype.onSetVariable=function(){document.getElementById("constraints").style.visibility="visible";if(document.getElementById("categories"))document.getElementById("categories").style.display="none";this.toggleUIMask("none");if(this.state.categorynames)if(this.state.categorynames.length>0){var categories=this.state.categorynames[0];for(var i=1;i<this.state.categorynames.length;i++)categories+=" / "+this.state.categorynames[i]}else var categories=this.state.datasets[this.state.dataset].getDatasetName();
var info=document.createElement("IMG");info.onclick=this.getMetadata.LASBind(this);info.src="images/icon_info.gif";var varlist=document.createElement("SELECT");varlist.id="variables";var cats=document.createElement("TEXT");cats.innerHTML=categories;if(document.getElementById(this.anchors.breadcrumb)){while(document.getElementById(this.anchors.breadcrumb).firstChild)document.getElementById(this.anchors.breadcrumb).removeChild(document.getElementById(this.anchors.breadcrumb).firstChild);document.getElementById(this.anchors.breadcrumb).appendChild(info);
document.getElementById(this.anchors.breadcrumb).appendChild(cats);document.getElementById(this.anchors.breadcrumb).appendChild(varlist)}for(var i=0;i<this.state.datasets[this.state.dataset].getCategorySize();i++)this.createVariableOptionNode({category:this.state.datasets[this.state.dataset]},i);var varObj=this.state.datasets[this.state.dataset].getChildByID(this.state.variable);if(varObj){if(varObj.grid_type!="scattered"){if(this.refs.analysis.enabled){this.hideAnalysis();this.showAnalysis()}document.getElementById("analysisWrapper").style.display=
""}else{document.getElementById("analysisWrapper").style.display="none";this.refs.analysis.enabled=false}if(document.getElementById("V6"))document.getElementById("V6").href="servlets/datasets?dset="+this.urlencode(categories+"/"+varObj.name)}document.getElementById("ol_map_widget").onmouseover=null};
LASUI.prototype.selectCategory=function(evt){var args=arguments;var parentNode=args[1];var i=args[2];if(!parentNode.children[i].isExpanded){if(parentNode==this.refs.categories){this.state.categories={};this.state.categories[parentNode.category.getChild(i).ID]={}}for(var c=0;c<parentNode.children.length;c++){this.collapse(parentNode.children[c]);for(var b=0;b<this.state.categorynames.length;b++)if(this.state.categorynames[b]==parentNode.category.getChildName(c))this.state.categorynames.splice(b,this.state.categorynames.length-
b)}this.expand(parentNode.children[i]);if(parentNode==this.refs.categories)this.state.categorynames=[];this.state.categorynames.push(parentNode.category.getChildName(i))}else{this.collapse(parentNode.children[i]);for(var c=0;c<this.state.categorynames.length;c++)if(this.state.categorynames[c]==parentNode.category.getChildName(i))this.state.categorynames.splice(c,this.state.categorynames.length-c)}if(!parentNode.children[i].category){parentNode.children[i].IMGNode.src="JavaScript/components/mozilla_blu.gif";
if(!document.all)var req=new XMLHttpRequest(this);else var req=new ActiveXObject("Microsoft.XMLHTTP");req.onreadystatechange=this.AJAXhandler.LASBind(this,req,"this.setCategoryTreeNode(req.responseText,args[3].children[args[4]],args[3].category.getChild(args[4]));",parentNode,i);req.open("GET",this.hrefs.getCategories.url+"?catid="+parentNode.category.getChildID(i));req.send(null);this.state.catid=parentNode.category.getChildID(i)}};
LASUI.prototype.setVariable=function(evt){var args=arguments;var dataset=args[1];var i=args[2];var datasetID=dataset.category.getDatasetID(i);var variableID=dataset.category.getChildID(i);var variable=dataset.category.getChild(i);this.state.datasets[datasetID]=dataset.category;this.state.lastDataset=this.state.dataset;this.state.dataset=datasetID;this.state.variable=variableID;this.getGrid(datasetID,variableID);this.getDataConstraints(datasetID,variableID);this.newVariable=true;if(this.onSetVariable)this.onSetVariable()};
LASUI.prototype.setDataset=function(dataset){this.state.dataset=dataset;this.state.newgrid=true;if(this.state.datasets[this.state.dataset].getChildByID(this.state.variable))this.getGrid(dataset,this.state.variable);if(this.onSetDataset)this.onSetDataset()};
LASUI.prototype.getDataConstraints=function(dataset,variable){if(!document.all)var req=new XMLHttpRequest(this);else var req=new ActiveXObject("Microsoft.XMLHTTP");req.onreadystatechange=this.AJAXhandler.LASBind(this,req,"this.setDataConstraints(req.responseText);");req.open("GET",this.hrefs.getDataConstraints.url+"?dsid="+dataset+"&varid="+variable);req.send(null)};
LASUI.prototype.setDataConstraints=function(strJson){if(strJson){var response=eval("("+strJson+")");if(!this.state.constraints)this.state.constraints={};this.state.lastconstraints=this.state.constraints;this.state.constraints=response.constraints}if(this.state.lastconstraints!=this.state.constraints){document.getElementById("DataConstraints").innerHTML="";document.getElementById("DataConstraints").style.display="";if(this.state.constraints.constraint){this.refs.constraints=[];for(var c=0;c<this.state.constraints.constraint.length;c++){var constraint=
{};var DIVNode=document.createElement("DIV");constraint.apply=document.createElement("INPUT");constraint.apply.type="checkbox";DIVNode.appendChild(constraint.apply);if(this.state.constraints.constraint[c].constraint.menu.content){var temp=this.state.constraints.constraint[c].constraint.menu;this.state.constraints.constraint[c].constraint.menu=[];this.state.constraints.constraint[c].constraint.menu[0]=temp}for(var m=0;m<this.state.constraints.constraint[c].constraint.menu.length;m++){eval("constraint."+
this.state.constraints.constraint[c].constraint.menu[m].position+' = document.createElement("SELECT")');if(this.state.constraints.constraint[c].constraint.menu[m].item.content){var temp=this.state.constraints.constraint[c].constraint.menu[m].item;this.state.constraints.constraint[c].constraint.menu[m].item=[];this.state.constraints.constraint[c].constraint.menu[m].item[0]=temp}for(var i=0;i<this.state.constraints.constraint[c].constraint.menu[m].item.length;i++){var option=document.createElement("option");
option.value=this.state.constraints.constraint[c].constraint.menu[m].item[i].values;option.appendChild(document.createTextNode(this.state.constraints.constraint[c].constraint.menu[m].item[i].content));eval("constraint."+this.state.constraints.constraint[c].constraint.menu[m].position+".appendChild(option)")}}if(constraint.lhs)DIVNode.appendChild(constraint.lhs);if(constraint.ops)DIVNode.appendChild(constraint.ops);if(constraint.rhs)DIVNode.appendChild(constraint.rhs);else{constraint.rhs=document.createElement("INPUT");
constraint.rhs.type="text";DIVNode.appendChild(constraint.rhs)}constraint.type=this.state.constraints.constraint[c].constraint.type;document.getElementById("DataConstraints").appendChild(DIVNode);this.refs.constraints.push(constraint)}}}};
LASUI.prototype.getOperations=function(dataset,variable,view){if(!document.all)var req=new XMLHttpRequest(this);else var req=new ActiveXObject("Microsoft.XMLHTTP");var url=this.hrefs.getOperations.url+"?dsid="+dataset+"&varid="+variable+"&view="+view;if(view)if(!this.AJAX_cache[url]){this.AJAX_cache[url]="waiting";req.onreadystatechange=this.AJAXhandler.LASBind(this,req,"this.AJAX_cache['"+url+"'] = req.responseText; this.setOperationList(req.responseText);");req.open("GET",url);req.send(null)}else if(this.AJAX_cache[url]!=
"waiting")this.setOperationList(this.AJAX_cache[url])};LASUI.prototype.setDownloadOperation=function(evt){var args=arguments;var id=args[1];var optiondef=args[2];this.state.operation.download=id;this.state.optiondefs.download=optiondef;var view=args[2];var optiondef=args[3];this.state.view.download=this.state.view.plot};
LASUI.prototype.doDownload=function(){if(!this.state.operation.download||this.refs.operations.download.SELECTNode.selectedIndex==0){alert("Please choose a file format to download.");return}if(document.getElementById("OPTION_DOWNLOAD_"+this.state.operation.download).disabled){alert("The "+document.getElementById("OPTION_DOWNLOAD_"+this.state.operation.download).innerHTML+" download format is not compatible with the current plot view. Please choose another plot view, or another download format.");return}if(this.state.optiondefs.download!=
""){this.toggleUIMask("");this.refs.options.download.DOMNode.style.display="";this.getOptions(this.state.optiondefs.download,"download",true)}else this.makeRequest({},"download")};
LASUI.prototype.setOperation=function(evt){var args=arguments;var id=args[1];var optiondef=args[3];var type=args[4];if(!type)type="plot";if(type=="plot")try{if(this.state.operations)if(this.state.operations.getOperationByID(id).optiondef.IDREF)optiondef=this.state.operations.getOperationByID(id).optiondef.IDREF}catch(e){}if(type=="plot"&&document.all&&evt.srcElement){for(var t in this.refs.operations.plot.children)if(this.refs.operations.plot.children[t].radio)this.refs.operations.plot.children[t].radio.checked=
false;evt.srcElement.checked=true}this.state.operation[type]=id;this.refs.options[type].DOMNode.innerHTML="";var view=args[2];this.state.view[type]=view;if(this.refs.analysis.enabled)for(var a in this.state.analysis.axes)if(view.indexOf(a)<0){view+=a;this.refs.analysis.axes[a].selected=true}else{this.refs.analysis.axes[a].selected=false;if(a=="x"||a=="y")this.refs.analysis.axes["xy"].selected=false;delete this.state.analysis.axes[a]}this.state.view.widgets=view;this.updateConstraints(view);this.state.lastVariable=
this.state.variable;this.state.lastDataset=this.state.dataset;if(type=="plot"&&this.state.operation.plot=="init")this.getOperations(this.state.dataset,this.state.variable,this.state.view.plot);if(optiondef)this.getOptions(optiondef,"plot",false)};LASUI.prototype.genericHandler=function(evt){if(arguments[1])eval(arguments[1])};
LASUI.prototype.setOperationList=function(strJson){var response=eval("("+strJson+")");var setDefault=true;this.state.operations=new LASGetOperationsResponse(response);for(var row=0;row<document.getElementById("productButtons").childNodes.length;row++)for(var cell=0;cell<document.getElementById("productButtons").childNodes[row].childNodes.length;cell++)try{document.getElementById("productButtons").childNodes[row].style.visibility="hidden"}catch(e){}for(var o in this.refs.operations.download.children)this.refs.operations.download.children[o].OPTIONNode.disabled=
true;for(var row=0;row<document.getElementById("productButtons").childNodes.length;row++)var setDefaultVis=true;if(!this.state.operations.response.operations.error)for(var i=0;i<this.state.operations.getOperationCount();i++){this.setOperationNode(this.state.operations.getOperationID(i),this.state.operations.getOperationName(i));if(this.state.operations.getOperation(i).category=="visualization")if(this.state.operations.getOperation(i)["default"]=="true"){this.state.operation.plot=this.state.operations.getOperationID(i);
setDefaultVis=false}else var defaultVis=this.state.operations.getOperationID(i)}if(setDefaultVis==true&&defaultVis)this.state.operation.plot=defaultVis;this.getOptions(this.state.operations.getOperationByID(this.state.operation.plot).optiondef.IDREF,"plot",true);if(this.refs.analysis.enabled||!this.state.grid.hasAxis("t"))document.getElementById("Animation").style.visibility="hidden"};
LASUI.prototype.setOperationNode=function(id,name){var button=document.getElementById(name);if(button){button.style.visibility="visible";button.onclick=this.doProductIconClick.LASBind(this,id)}var option=document.getElementById("OPTION_DOWNLOAD_"+id);if(option)option.disabled=""};
LASUI.prototype.doProductIconClick=function(evt){var args=arguments;var id=args[1];this.state.operation.external=id;this.state.view.external=this.state.view.plot;this.toggleUIMask("");if(this.state.operations.getOperationByID(id))if(this.state.operations.getOperationByID(id).optiondef){this.getOptions(this.state.operations.getOperationByID(id).optiondef.IDREF,"external",true);this.refs.options.external.DOMNode.style.display=""}else{this.refs.options.external.DOMNode.style.display="none";this.toggleUIMask("none");
this.makeRequest({},"external");return}};
LASUI.prototype.getGrid=function(dataset,variable){var url=this.hrefs.getGrid.url+"?dsid="+dataset+"&varid="+variable;if(!this.AJAX_cache[url]){this.AJAX_cache[url]="waiting";if(!document.all)var req=new XMLHttpRequest(this);else var req=new ActiveXObject("Microsoft.XMLHTTP");req.onreadystatechange=this.AJAXhandler.LASBind(this,req,"this.AJAX_cache['"+url+"']=req.responseText;this.setGrid(req.responseText);");req.open("GET",this.hrefs.getGrid.url+"?dsid="+dataset+"&varid="+variable);req.send(null)}else if(this.AJAX_cache[url]!=
"waiting")this.setGrid(AJAX_cache[url])};LASUI.prototype.setGrid=function(strJson){if(strJson==""){alert("This dataset is currently unavailable.");return-1}eval("var response = ("+strJson+")");if(this.state.grid)this.state.lastgrid=this.clone(this.state.grid);this.state.grid=new LASGetGridResponse(response);if(!this.state.lastgrid)this.state.lastgrid=this.clone(this.state.grid);this.getViews(this.state.dataset,this.state.variable)};
LASUI.prototype.getViews=function(dataset,variable){var url=this.hrefs.getViews.url+"?dsid="+dataset+"&varid="+variable;if(!this.AJAX_cache[url]){this.AJAX_cache[url]="waiting";if(!document.all)var req=new XMLHttpRequest(this);else var req=new ActiveXObject("Microsoft.XMLHTTP");req.onreadystatechange=this.AJAXhandler.LASBind(this,req,"this.AJAX_cache['"+url+"']=req.responseText;this.setViews(req.responseText);");req.open("GET",url);req.send(null)}if(this.AJAX_cache[url]!="waiting")this.setViews(this.AJAX_cache[url])};
LASUI.prototype.setViews=function(strJson){var response=eval("("+strJson+")");if(!this.refs.views)this.refs.views={};this.refs.views.views=new LASGetViewsResponse(response);this.setDefaultProductMenu();if(this.refs.views.views.getViewByID(this.state.view.plot))this.getOperations(this.state.dataset,this.state.variable,this.state.view.plot)};
LASUI.prototype.setDefaultProductMenu=function(){while(this.refs.operations.plot.DOMNode.firstChild)this.refs.operations.plot.DOMNode.removeChild(this.refs.operations.plot.DOMNode.firstChild);while(this.refs.operations.download.DOMNode.firstChild)this.refs.operations.download.DOMNode.removeChild(this.refs.operations.download.DOMNode.firstChild);for(var type in this.refs.operations)this.refs.operations[type].children={};delete this.refs.operations.download.SELECTNode;var setPlotDefault="true";var setDownloadDefault=
"true";var defaultPlotProduct=null;var defaultDownloadProduct=null;for(var type in this.products)for(var product in this.products[type]){var useView=true;if(this.products[type][product].view)for(var axis=0;axis<this.products[type][product].view.length;axis++)if(!this.state.grid.hasAxis(this.products[type][product].view.charAt(axis))||!this.refs.views.views.getViewByID(this.products[type][product].view))useView=false;if(useView){if(!this.refs.operations.plot.children)this.refs.operations.plot.children=
{};if(!this.refs.operations.plot.children[type])this.setProductTypeNode(type);this.setProductNode(type,product);if(defaultPlotProduct==null){var defaultPlotProduct=this.products[type][product];var defaultPlotProductName=product}if(this.state.operation.plot==this.products[type][product].id&&this.state.view.plot==this.products[type][product].view){setPlotDefault=false;this.refs.operations.plot.children[product].radio.checked=true;this.setOperation(this,this.products[type][product].id,this.products[type][product].view,
this.products[type][product].optiondef)}}}if(setPlotDefault){this.setOperation(this,defaultPlotProduct.id,defaultPlotProduct.view,defaultPlotProduct.optiondef);this.refs.operations.plot.children[defaultPlotProductName].radio.checked=true}};
LASUI.prototype.setProductTypeNode=function(type){this.refs.operations.plot.children[type]={};this.refs.operations.plot.children[type].LINode=document.createElement("LI");this.refs.operations.plot.children[type].LINode;this.refs.operations.plot.children[type].title=document.createElement("TEXT");this.refs.operations.plot.children[type].title.innerHTML="<b>"+type+"</b>";this.refs.operations.plot.children[type].LINode.className="LASPlotCategory";this.refs.operations.plot.children[type].LINode.appendChild(this.refs.operations.plot.children[type].title);
this.refs.operations.plot.DOMNode.appendChild(this.refs.operations.plot.children[type].LINode)};
LASUI.prototype.setProductNode=function(type,product){this.refs.operations.plot.children[product]={};this.refs.operations.plot.children[product].LINode=document.createElement("LI");this.refs.operations.plot.children[product].LINode.className="LASPlotType";if(this.products[type][product].view.length==0)this.refs.operations.plot.children[product].LINode.style.display="none";this.refs.operations.plot.children[product].title=document.createTextNode(product);this.refs.operations.plot.children[product].radio=
document.createElement("INPUT");this.refs.operations.plot.children[product].radio.type="radio";this.refs.operations.plot.children[product].radio.name="product";this.refs.operations.plot.children[product].radio.className="LASRadioInputNode";this.refs.operations.plot.children[product].radio.value=product.id;this.refs.operations.plot.children[product].radio.onselect=this.setOperation.LASBind(this,this.products[type][product].id,this.products[type][product].view,this.products[type][product].optiondef,
"plot");this.refs.operations.plot.children[product].radio.onclick=this.setOperation.LASBind(this,this.products[type][product].id,this.products[type][product].view,this.products[type][product].optiondef,"plot");this.refs.operations.plot.children[product].LINode.appendChild(this.refs.operations.plot.children[product].radio);this.refs.operations.plot.children[product].LINode.appendChild(this.refs.operations.plot.children[product].title);this.refs.operations.plot.DOMNode.appendChild(this.refs.operations.plot.children[product].LINode)};
LASUI.prototype.onPlotLoad=function(e){var urlArr=window.frames[this.anchors.output].document.location.search.replace("?","").split("&");for(var i=0;i<urlArr.length;i++)if(urlArr[i].substr(0,3)=="xml")var Req=new LASRequest(unescape(urlArr[i].substr(4,urlArr[i].length)).replace(/\+/g," "));if(Req)if(Req.getXMLText&&!isFeatureEditing()&&this.state.view.plot=="xy")setMapCurrentSelection(Req.getRangeLo("y"),Req.getRangeHi("y"),Req.getRangeLo("x"),Req.getRangeHi("x"));if(document.getElementById("wait"))document.getElementById("wait").style.visibility=
"hidden";if(document.getElementById("wait_msg"))document.getElementById("wait_msg").style.display="none";if(document.getElementById("output"))document.getElementById("output").style.visibility="visible";if(document.getElementById("update"))document.getElementById("update").style.color=""};
LASUI.prototype.roundGrid=function(grid){var outgrid={x:{min:0,max:0},y:{min:0,max:0}};outgrid.x.min=Math.round(grid.x.min*1E3)/1E3;outgrid.x.max=Math.round(grid.x.max*1E3)/1E3;outgrid.y.min=Math.round(grid.y.min*1E3)/1E3;outgrid.y.max=Math.round(grid.y.max*1E3)/1E3;return outgrid};
LASUI.prototype.updateConstraints=function(view){if(!this.state.grid)return;if(view==null&&view!="")view=this.state.view.widgets;else this.state.view.widgets=view;while(document.getElementById("Date").firstChild)document.getElementById("Date").removeChild(document.getElementById("Date").firstChild);while(document.getElementById("Depth").firstChild)document.getElementById("Depth").removeChild(document.getElementById("Depth").firstChild);var reset=false;var resetXY=false;if(this.state.lastgrid)if(this.state.grid.response.grid.ID!=
this.state.lastgrid.response.grid.ID)reset=true;if(this.state.lastDataset!=this.state.dataset||this.resetXY){var resetXY=true;this.resetXY=false;this.state.selectGlobal=false}if(this.state.lastDataset!=this.state.dataset)var reset=true;if(!this.initialized)reset=true;if(view.indexOf("x")>=0&&view.indexOf("y")>=0)this.initXYSelect("xy",resetXY);else if(view.indexOf("x")>=0&&view.indexOf("y")<0)this.initXYSelect("x",resetXY);else if(view.indexOf("x")<0&&view.indexOf("y")>=0)this.initXYSelect("y",resetXY);
else if(view.indexOf("x")<0&&view.indexOf("y")<0)this.initXYSelect("pt",resetXY);for(var d=0;d<this.state.grid.response.grid.axis.length;d++)if(view.indexOf(this.state.grid.response.grid.axis[d].type)<0)if(this.state.datasets[this.state.dataset].getChildByID(this.state.variable).grid_type!="scattered"&&!this.refs.analysis.enabled)eval("this.init"+this.state.grid.response.grid.axis[d].type.toUpperCase()+"Constraint('point',reset)");else eval("this.init"+this.state.grid.response.grid.axis[d].type.toUpperCase()+
"Constraint('range',reset)");else eval("this.init"+this.state.grid.response.grid.axis[d].type.toUpperCase()+"Constraint('range',reset)");if(this.refs.analysis.enabled)for(var d=0;d<this.state.grid.response.grid.axis.length;d++)if(view.indexOf(this.state.grid.response.grid.axis[d].type)<0)switch(this.state.grid.response.grid.axis[d].type){case "z":this.refs.DepthWidget[this.refs.DepthWidget.widgetType][1].disabled=true;break;case "t":if(this.refs.DW.widgetType)this.refs.DW.disable("hi");else this.refs.DW[1].disabled=
true;break}else switch(this.state.grid.response.grid.axis[d].type){case "z":this.refs.DepthWidget[this.refs.DepthWidget.widgetType][1].disabled=false;break;case "t":if(this.refs.DW.widgetType)this.refs.DW.enable("hi");else this.refs.DW[1].disabled=false;break}this.initialized=true;if(!this.updating)if(this.autoupdate)this.makeRequest();else this.showUpdateLink();this.updating=false;this.state.lastgrid=this.clone(this.state.grid)};
LASUI.prototype.initXYSelect=function(mode,reset){if(this.state.grid.getAxis("x")&&this.state.grid.getAxis("y")&&reset){setMapTool(mode);setMapDataExtent(parseFloat(this.state.grid.getLo("y")),parseFloat(this.state.grid.getHi("y")),parseFloat(this.state.grid.getLo("x")),parseFloat(this.state.grid.getHi("x")),parseFloat(this.state.grid.getDelta("x")))}else setMapTool(mode)};LASUI.prototype.initXConstraint=function(mode){};LASUI.prototype.initYConstraint=function(mode){};
LASUI.prototype.initZConstraint=function(mode,reset){while(document.getElementById("Depth").firstChild)document.getElementById("Depth").removeChild(document.getElementById("Depth").firstChild);if(!this.state.selection.z)this.state.selection.z={min:null,max:null};if(this.state.grid.hasMenu("z"))if(reset||this.refs.DepthWidget.widgetType!="menu"){this.refs.DepthWidget.menu=[document.createElement("SELECT"),document.createElement("SELECT")];this.refs.DepthWidget.widgetType="menu";for(var m=0;m<this.refs.DepthWidget[this.refs.DepthWidget.widgetType].length;m++){for(var v=
0;v<this.state.grid.getMenu("z").length;v++){var _opt=document.createElement("OPTION");_opt.value=this.state.grid.getMenu("z")[v][1];_opt.className="LASOptionNode";_opt.appendChild(document.createTextNode(this.state.grid.getMenu("z")[v][0]));if(m==1&&v>=this.state.grid.getMenu("z").length-1)_opt.selected=true;if(m==0&&v==0)_opt.selected=true;this.refs.DepthWidget[this.refs.DepthWidget.widgetType][m].appendChild(_opt)}this.refs.DepthWidget[this.refs.DepthWidget.widgetType][m].className="LASSelectNode";
this.refs.DepthWidget[this.refs.DepthWidget.widgetType][m].onchange=this.handleDepthRangeChange.LASBind(this)}}if(this.state.grid.hasArange("z"))if(reset||this.refs.DepthWidget.widgetType!="arange"){this.refs.DepthWidget.arange=[document.createElement("SELECT"),document.createElement("SELECT")];this.refs.DepthWidget.widgetType="arange";for(var m=0;m<this.refs.DepthWidget[this.refs.DepthWidget.widgetType].length;m++){this.refs.DepthWidget[this.refs.DepthWidget.widgetType][m].className="LASSelectNode";
for(var v=parseFloat(this.state.grid.getLo("z"));v<=parseFloat(this.state.grid.getHi("z"));v+=parseFloat(this.state.grid.getDelta("z"))){var _opt=document.createElement("option");_opt.value=v;_opt.className="LASOptionNode";_opt.appendChild(document.createTextNode(v));if(m==1&&v==this.state.grid.getHi("z"))_opt.selected=true;if(m==0&&v==this.state.grid.getLo("z"))_opt.selected=true;this.refs.DepthWidget[this.refs.DepthWidget.widgetType][m].appendChild(_opt)}this.refs.DepthWidget[this.refs.DepthWidget.widgetType][m].onchange=
this.handleDepthRangeChange.LASBind(this)}}switch(mode){case "range":var depth_label2=document.createElement("STRONG");depth_label2.appendChild(document.createTextNode("Minimum Depth ("+this.state.grid.getAxis("z").units+") : "));document.getElementById("Depth").appendChild(depth_label2);document.getElementById("Depth").appendChild(this.refs.DepthWidget[this.refs.DepthWidget.widgetType][0]);document.getElementById("Depth").appendChild(document.createElement("BR"));var depth_label3=document.createElement("STRONG");
depth_label3.appendChild(document.createTextNode("Maximum Depth ("+this.state.grid.getAxis("z").units+") : "));document.getElementById("Depth").appendChild(depth_label3);document.getElementById("Depth").appendChild(this.refs.DepthWidget[this.refs.DepthWidget.widgetType][1]);document.getElementById("Depth").style.display="";break;case "point":var depth_label=document.createElement("STRONG");depth_label.appendChild(document.createTextNode("Depth ("+this.state.grid.getAxis("z").units+") : "));document.getElementById("Depth").appendChild(depth_label);
document.getElementById("Depth").appendChild(this.refs.DepthWidget[this.refs.DepthWidget.widgetType][0]);document.getElementById("Depth").style.display="";break}};
LASUI.prototype.initTConstraint=function(mode,reset){document.getElementById("Date").style.display="";while(document.getElementById("Date").firstChild)document.getElementById("Date").removeChild(document.getElementById("Date").firstChild);if(!this.state.selection.t)this.state.selection.t={min:null,max:null};switch(this.state.grid.getDisplayType("t")){case "widget":if(reset||!this.refs.DW)if(reset||this.refs.DW.widgetType!="DateWidget"){this.refs.DW=new DateWidget(this.state.grid.getLo("t"),this.state.grid.getHi("t"));
this.refs.DW.callback=this.handleDateRangeChange.LASBind(this)}var DWDisplay="";if(this.state.grid.getAxis("t").monthNeeded=="true")DWDisplay+="M";if(this.state.grid.getAxis("t").dayNeeded=="true")DWDisplay+="D";if(this.state.grid.getAxis("t").yearNeeded=="true")DWDisplay+="Y";if(this.state.grid.getAxis("t").hourNeeded=="true"||this.state.grid.getAxis("t").hoursNeeded=="true")DWDisplay+="T";switch(mode){case "range":document.getElementById("Date").innerHTML="<table><tbody><tr><td><table><tbody><tr><td><strong>Start Date :</strong></td></tr><tr><td><strong>End Date :</strong></tr></tbody></table></td><td id='DWAnchor'></td></tr></tbody></table>";
this.refs.DW.render("DWAnchor",DWDisplay,DWDisplay);break;case "point":document.getElementById("Date").innerHTML="<table><tbody><tr><td><table><tbody><tr><td><strong>Date :</strong></td><td id='DWAnchor'></td></tr></tbody></table>";this.refs.DW.render("DWAnchor",DWDisplay);break}break;case "menu":if(reset||!this.refs.DW)if(reset||this.refs.DW[0].tagName!="select"){this.refs.DW=[document.createElement("select"),document.createElement("select")];for(var m=0;m<this.refs.DW.length;m++){this.refs.DW[m].onchange=
this.handleDateRangeChange.LASBind(this);this.refs.DW[m].className="LASSelectNode";for(var v=0;v<this.state.grid.getMenu("t").length;v++){var _opt=document.createElement("option");_opt.value=this.state.grid.getMenu("t")[v][1];_opt.className="LASOptionNode";_opt.appendChild(document.createTextNode(this.state.grid.getMenu("t")[v][0]));if(m==1&&v>=this.state.grid.getMenu("t").length-1)_opt.selected=true;if(m==0&&v==0)_opt.selected=true;this.refs.DW[m].appendChild(_opt)}}}switch(mode){case "range":var date_label=
document.createElement("STRONG");date_label.appendChild(document.createTextNode("Start Date : "));document.getElementById("Date").appendChild(date_label);document.getElementById("Date").appendChild(this.refs.DW[0]);document.getElementById("Date").appendChild(document.createElement("BR"));var label=document.createElement("STRONG");label.appendChild(document.createTextNode("End Date : "));document.getElementById("Date").appendChild(label);document.getElementById("Date").appendChild(this.refs.DW[1]);
break;case "point":var date_label=document.createElement("STRONG");date_label.appendChild(document.createTextNode("Date : "));document.getElementById("Date").appendChild(date_label);document.getElementById("Date").appendChild(this.refs.DW[0]);break}break}};
LASUI.prototype.showUpdateLink=function(){this.expired=true;document.getElementById("update").style.color="#f5ed52";document.getElementById("update").style.visibility="visible";document.getElementById("plotOptionsButton").style.visibility="visible";if(document.getElementById("wait"))document.getElementById("wait").style.visibility="hidden";if(document.getElementById("wait_msg"))document.getElementById("wait_msg").style.display="none";if(document.getElementById("output"))document.getElementById("output").style.visibility=
"visible"};LASUI.prototype.toggleAutoUpdate=function(e,toggle){this.autoupdate=toggle;if(this.autoupdate&&this.expired)this.makeRequest();var e=e||event;e.stopPropagation?e.stopPropagation():(e.cancelBubble=true);return false};LASUI.prototype.makeDownloadRequest=function(){};
LASUI.prototype.makeRequest=function(evt,type){if(!type)var type="plot";if(!this.updating||this.expired){if(type=="plot"&&this.state.operation.plot=="init"){this.getOperations(this.state.dataset,this.state.variable,this.state.view.plot);return null}document.getElementById("output").height="100%";document.getElementById("output").width="100%";document.getElementById("update").style.visibility="visible";document.getElementById("plotOptionsButton").style.visibility="visible";this.request=null;this.uirequest=
"";this.request=new LASRequest("");this.state.view.download=this.state.view.plot;this.state.view.external=this.state.view.plot;this.request.removeVariables();this.request.removeConstraints();if(this.state.dataset==null){alert("Please select a dataset and variables.");return}if(this.state.variable==null){alert("Please select variables in the selected dataset.");return}if(this.state.operation[type]==null){alert("Please select a file format to download.");return}this.request.setOperation(this.state.operation[type]);
this.uirequest+="dsid="+this.state.dataset;this.uirequest+="&catid="+this.state.catid;this.uirequest+="&varid="+this.state.variable;this.uirequest+="&plot="+this.state.operation.plot;this.uirequest+="&view="+this.state.view.plot;var uioptions="";for(var p in this.state.properties[type])if(typeof this.state.properties[type][p]!="function"&&typeof this.state.properties[type][p]=="object")this.request.setProperty(this.state.properties[type][p].type,p,this.urlencode(this.state.properties[type][p].value));
var view=this.state.view[type];this.request.setProperty("ferret","view",view);this.request.removeRegion();this.request.setVariable(this.state.dataset,this.state.variable);this.request.addRegion();if(this.refs.analysis.enabled&&this.state.analysis.name){var Analysis={label:this.state.analysis.name+" "+this.state.datasets[this.state.dataset].getChildByID(this.state.variable).name,axis:[]};for(var axis_id in this.state.analysis.axes){var Axis={type:axis_id,op:this.state.analysis.type};if(this.state.grid.hasAxis(axis_id)){var Axis=
{type:axis_id,op:this.state.analysis.type};switch(axis_id){case "x":Axis.lo=getMapXlo();Axis.hi=getMapXhi();break;case "y":Axis.lo=getMapYlo();Axis.hi=getMapYhi();break;case "t":if(this.state.grid.hasMenu("t")){Axis.lo=this.refs.DW[0].value;Axis.hi=this.refs.DW[1].value}else{Axis.lo=this.refs.DW.getDate1_Ferret();Axis.hi=this.refs.DW.getDate2_Ferret()}break;case "z":Axis.lo=this.refs.DepthWidget[this.refs.DepthWidget.widgetType][0].value;Axis.hi=this.refs.DepthWidget[this.refs.DepthWidget.widgetType][1].value;
break}Analysis.axis.push(Axis)}}if(Analysis.axis.length>0&&this.state.analysis.name!="None")this.request.setAnalysis(0,Analysis)}for(var d=0;d<this.state.grid.response.grid.axis.length;d++)if(!(this.refs.analysis.enabled&&this.state.analysis.name&&this.state.analysis.axes[this.state.grid.response.grid.axis[d].type]))switch(this.state.grid.response.grid.axis[d].type){case "x":if(this.state.view[type].indexOf("x")>=0||this.state.datasets[this.state.dataset].getChildByID(this.state.variable).grid_type==
"scattered")this.request.addRange("x",getMapXlo(),getMapXhi());else this.request.addRange("x",(getMapXlo()+getMapXhi())/2,(getMapXlo()+getMapXhi())/2);break;case "y":if(this.state.view[type].indexOf("y")>=0||this.state.datasets[this.state.dataset].getChildByID(this.state.variable).grid_type=="scattered")this.request.addRange("y",getMapYlo(),getMapYhi());else this.request.addRange("y",(getMapYlo()+getMapYhi())/2,(getMapYlo()+getMapYhi())/2);break;case "t":if(this.state.view[type].indexOf("t")>=0||
this.state.datasets[this.state.dataset].getChildByID(this.state.variable).grid_type=="scattered")if(this.state.grid.hasMenu("t"))this.request.addRange("t",this.refs.DW[0].value,this.refs.DW[1].value);else this.request.addRange("t",this.refs.DW.getDate1_Ferret(),this.refs.DW.getDate2_Ferret());else if(this.state.grid.hasMenu("t"))this.request.addRange("t",this.refs.DW[0].value);else this.request.addRange("t",this.refs.DW.getDate1_Ferret());break;case "z":if(this.state.view[type].indexOf("z")>=0||this.state.datasets[this.state.dataset].getChildByID(this.state.variable).grid_type==
"scattered")this.request.addRange("z",this.refs.DepthWidget[this.refs.DepthWidget.widgetType][0].value,this.refs.DepthWidget[this.refs.DepthWidget.widgetType][1].value);else this.request.addRange("z",this.refs.DepthWidget[this.refs.DepthWidget.widgetType][0].value);break}if(this.refs.constraints)for(var c=0;c<this.refs.constraints.length;c++)if(this.refs.constraints[c].apply.checked)switch(this.refs.constraints[c].type){case "text":this.request.addTextConstraint(this.urlencode(this.refs.constraints[c].lhs.value),
this.urlencode(this.refs.constraints[c].ops.value),this.urlencode(this.refs.constraints[c].rhs.value));break;case "variable":this.request.addVariableConstraint(this.urlencode(this.state.dataset),this.urlencode(this.refs.constraints[c].lhs.value),this.urlencode(this.refs.constraints[c].ops.value),this.urlencode(this.refs.constraints[c].rhs.value));break}document.getElementById("ol_map_widget").onmouseover=null;if(this.state.embed&&type=="plot"){if(document.getElementById("wait"))document.getElementById("wait").style.visibility=
"visible";if(document.getElementById("wait_msg"))document.getElementById("wait_msg").style.display="";document.getElementById("output").style.visibility="hidden";document.getElementById("output").src=this.hrefs.getProduct.url+"?xml="+this.urlencode(this.request.getXMLText())}else window.open(this.hrefs.getProduct.url+"?xml="+this.urlencode(this.request.getXMLText()))}this.updating=false;this.state.lastVariable=this.state.variable;this.state.lastDataset=this.state.dataset;this.state.selectGlobal=false;
if(this.state.grid.hasAxis("x")&&this.state.grid.hasAxis("y"))if(Math.abs(getMapXhi()-getMapXlo()-(this.state.grid.getHi("x")-this.state.grid.getLo("x")))<10&&Math.abs(getMapYhi()-getMapYlo()-(this.state.grid.getHi("y")-this.state.grid.getLo("y")))<5)this.state.selectGlobal=true;if(type=="plot"){this.expired=false;document.getElementById("update").style.color=""}};
LASUI.prototype.getOptions=function(optiondef,type,reset){var url=this.hrefs.getOptions.url+"?opid="+optiondef;var submit=document.createElement("INPUT");var cancel=document.createElement("INPUT");submit.type="submit";submit.value="OK";submit.className="LASSubmitInputNode";var strHandler="this.setChangedOptions('"+type+"');this.hideOptions('"+type+"')";if(type!="plot")strHandler+=";this.makeRequest({},'"+type+"')";submit.onclick=this.genericHandler.LASBind(this,strHandler);cancel.type="submit";cancel.value=
"Cancel";cancel.className="LASSubmitInputNode";cancel.onclick=this.genericHandler.LASBind(this,"this.cancelChangedOptions('"+type+"');this.hideOptions('"+type+"')");var reset=document.createElement("INPUT");reset.type="submit";reset.onclick=this.genericHandler.LASBind(this,"this.resetOptions('"+type+"')");reset.name="Reset";reset.value="Reset";while(this.refs.options[type].DOMNode.firstChild)this.refs.options[type].DOMNode.removeChild(this.refs.options[type].DOMNode.firstChild);this.refs.options[type].DOMNode.appendChild(submit);
this.refs.options[type].DOMNode.appendChild(reset);this.refs.options[type].DOMNode.appendChild(cancel);if(!this.AJAX_cache[url]){this.AJAX_cache[url]="waiting";if(!document.all)var req=new XMLHttpRequest(this);else var req=new ActiveXObject("Microsoft.XMLHTTP");req.onreadystatechange=this.AJAXhandler.LASBind(this,req,"this.AJAX_cache['"+url+"']=req.responseText;this.setOptionList(req.responseText,args[3],args[4],args[5]);",this.refs.options[type].DOMNode,type,reset);req.open("GET",this.hrefs.getOptions.url+
"?opid="+optiondef);req.send(null)}else if(this.AJAX_cache[url]!="waiting")this.setOptionList(this.AJAX_cache[url],this.refs.options[type].DOMNode,type,reset)};
LASUI.prototype.setOptionList=function(strJson,DOMNode,type,reset){var table=document.createElement("TABLE");table.style.margin="-4pt";table.style.marginLeft="6pt";table.cellpadding="0";table.cellspacing="0";var tbody=document.createElement("TBODY");table.appendChild(tbody);DOMNode.appendChild(table);var response=eval("("+strJson+")");var setDefault=true;this.state.properties[type]=[];this.refs.options[type].options=new LASGetOptionsResponse(response);var ct=this.refs.options[type].options.getOptionCount();
if(ct)for(var i=0;i<ct;i++)this.setOptionTRNode(this.refs.options[type].options.getOptionID(i),tbody,type,reset);if(!this.updating)if(this.autoupdate||this.submitOnLoad||this.newVariable){this.submitOnLoad=false;this.newVariable=false;this.makeRequest()}else this.showUpdateLink()};
LASUI.prototype.setOptionTRNode=function(id,TBODYNode,type,reset){if(!this.refs.options.cache)this.refs.options.cache={};if(!this.refs.options.cache[id]||reset){this.refs.options.cache[id]=this.refs.options[type].options.getOptionByID(id);this.refs.options.cache[id].TRNode=document.createElement("TR");this.refs.options.cache[id].TD1=document.createElement("TD");this.refs.options.cache[id].TD1.width="45%";this.refs.options.cache[id].TD1.appendChild(document.createTextNode(this.refs.options.cache[id].title));
this.refs.options.cache[id].TD2=document.createElement("TD");if(this.refs.options.cache[id].menu){this.refs.options.cache[id].SELECTNode=document.createElement("SELECT");this.refs.options.cache[id].SELECTNode.setAttribute("name",id);if(!this.state.properties[type][id])this.state.properties[type][id]={type:"ferret",value:this.refs.options.cache[id].menu.item[0].values};for(var i=0;i<this.refs.options.cache[id].menu.item.length;i++){var option=document.createElement("OPTION");option.value=this.refs.options.cache[id].menu.item[i].values;
option.appendChild(document.createTextNode(this.refs.options.cache[id].menu.item[i].content));this.refs.options.cache[id].SELECTNode.appendChild(option)}this.refs.options.cache[id].TD2.appendChild(this.refs.options.cache[id].SELECTNode)}else{if(!this.state.properties[type][id])this.state.properties[type][id]={type:"ferret",value:""};this.refs.options.cache[id].INPUTNode=document.createElement("INPUT");this.refs.options.cache[id].INPUTNode.type="text";this.refs.options.cache[id].INPUTNode.className=
"LASTextInputNode";this.refs.options.cache[id].TD2.appendChild(this.refs.options.cache[id].INPUTNode)}this.refs.options.cache[id].TD3=document.createElement("TD");this.refs.options.cache[id].A=document.createElement("A");if(!this.info_icon){this.info_icon=document.createElement("img");this.info_icon.src="images/icon_info.gif"}this.refs.options.cache[id].A.appendChild(this.info_icon);this.refs.options.cache[id].A.onclick=this.showOptionInfo.LASBind(this,this.refs.options.cache[id].help);this.refs.options.cache[id].TD3.appendChild(this.refs.options.cache[id].A);
this.refs.options.cache[id].TRNode.appendChild(this.refs.options.cache[id].TD1);this.refs.options.cache[id].TRNode.appendChild(this.refs.options.cache[id].TD2);this.refs.options.cache[id].TRNode.appendChild(this.refs.options.cache[id].TD3)}if(type=="plot"){if(this.refs.options.cache[id].SELECTNode)this.refs.options.cache[id].SELECTNode.onchange=this.setOption.LASBind(this,id,"plot",this.refs.options.cache[id]);if(this.refs.options.cache[id].INPUTNode)this.refs.options.cache[id].INPUTNode.onchange=
this.setOption.LASBind(this,id,"plot",this.refs.options.cache[id]);TBODYNode.appendChild(this.refs.options.cache[id].TRNode)}else{var clone=this.clone(this.refs.options.cache[id]);clone.TD2.innerHTML="";if(clone.SELECTNode){clone.SELECTNode.onchange=this.setOption.LASBind(this,id,type,clone);clone.SELECTNode.selectedIndex=this.refs.options.cache[id].SELECTNode.selectedIndex;clone.SELECTNode.onchange({target:clone.SELECTNode},id,type,clone);clone.TD2.appendChild(clone.SELECTNode)}if(clone.INPUTNode){clone.INPUTNode.onchange=
this.setOption.LASBind(this,id,type,clone);clone.INPUTNode.value=this.refs.options.cache[id].INPUTNode.value;clone.INPUTNode.onchange({target:clone.INPUTNode},id,type,clone);clone.TD2.appendChild(clone.INPUTNode)}while(clone.TRNode.firstChild)clone.TRNode.removeChild(clone.TRNode.firstChild);clone.TRNode.appendChild(clone.TD1);clone.TRNode.appendChild(clone.TD2);clone.TRNode.appendChild(this.refs.options.cache[id].TD3);TBODYNode.appendChild(clone.TRNode)}};
LASUI.prototype.showOptions=function(type){if(this.refs.options[type].options){this.toggleUIMask("");document.getElementById(type+"Options").style.display=""}};LASUI.prototype.hideOptions=function(type){this.refs.options[type].DOMNode.style.display="none";this.toggleUIMask("none")};
LASUI.prototype.resetOptions=function(type){while(this.refs.options[type].DOMNode.firstChild)this.refs.options[type].DOMNode.removeChild(this.refs.options[type].DOMNode.firstChild);this.getOptions(this.state.operations.getOperationByID(this.state.operation[type]).optiondef.IDREF,type,true);this.showOptions(type)};
LASUI.prototype.showOptionInfo=function(evt){if(this.optionInfo)if(this.optionInfo.parentNode)this.optionInfo.parentNode.removeChild(this.optionInfo);this.optionInfo=document.createElement("DIV");document.body.appendChild(this.optionInfo);this.optionInfo.className="LASPopupDIVNode";this.optionInfo.style.left=this.optionInfo.offsetLeft+3+"px";this.optionInfo.style.top=this.optionInfo.offsetTop+3+"px";var close=document.createElement("INPUT");var center=document.createElement("CENTER");close.type="submit";
close.onclick=this.hideOptionInfo.LASBind(this,this.optionInfo);close.name="Close";close.value="Close";this.optionInfo.innerHTML+=arguments[1];center.appendChild(close);this.optionInfo.appendChild(center)};LASUI.prototype.hideOptionInfo=function(){var div=arguments[1];div.parentNode.removeChild(div)};
LASUI.prototype.setOption=function(evt){var args=arguments;var id=args[1];if(evt.target)var node=evt.target;else if(evt.srcElement)var node=evt.srcElement;else return;if(args[3].SELECTNode)this.state.newproperties[args[2]][id]={type:"ferret",value:node.options[node.selectedIndex].value};else this.state.newproperties[args[2]][id]={type:"ferret",value:node.value}};
LASUI.prototype.setChangedOptions=function(type){var ct=0;for(var id in this.state.newproperties[type]){this.state.properties[type][id]=this.state.newproperties[type][id];ct++}if(!this.updating&&type=="plot"&&ct>0)if(this.autoupdate)this.makeRequest();else this.showUpdateLink();this.state.newproperties={plot:[],external:[],download:[]}};
LASUI.prototype.cancelChangedOptions=function(){for(var type in this.state.newproperties)for(var id in this.state.newproperties[type])if(this.refs.options.cache[id]&&this.state.properties[type][id])if(this.refs.options.cache[id].SELECTNode)for(var i=0;i<this.refs.options.cache[id].SELECTNode.length;i++){if(this.refs.options.cache[id].SELECTNode.options[i].value==this.state.properties[type][id].value){this.refs.options.cache[id].SELECTNode.selectedIndex=i;this.refs.options.cache[id].SELECTNode.options[i].selected=
true}}else if(this.refs.options.cache[id].INPUTNode)this.refs.options.cache[id].INPUTNode.value=this.state.properties[type][id].value};LASUI.prototype.onafterdraw=function(evt){this.state.selection.x.min=getMapXlo();this.state.selection.x.max=getMapXhi();this.state.selection.y.min=getMapYlo();this.state.selection.y.max=getMapYhi();if(!this.updating)if(this.autoupdate)this.makeRequest();else this.showUpdateLink()};
LASUI.prototype.handleDepthRangeChange=function(evt){if(!this.updating)if(this.autoupdate)this.makeRequest();else this.showUpdateLink()};LASUI.prototype.handleDepthChange=function(evt){if(!this.updating)if(this.autoupdate)this.makeRequest();else this.showUpdateLink()};LASUI.prototype.handleDateRangeChange=function(evt){if(!this.updating)if(this.autoupdate)this.makeRequest();else this.showUpdateLink()};
LASUI.prototype.handleDateChange=function(evt){if(!this.updating)if(this.autoupdate)this.makeRequest();else this.showUpdateLink()};LASUI.prototype.collapseRootNodes=function(evt){var args=arguments;if(!this.refs[args[1]].isExpanded){this.expand(this.refs[args[1]]);if(args[1]!="categories")this.collapse(this.refs.categories);if(args[1]!="views")this.collapse(this.refs.views);if(args[1]!="operations")this.collapse(this.refs.operations.plot);if(args[1]!="options")this.collapse(this.refs.options)}else this.collapse(this.refs[args[1]])};
LASUI.prototype.showAnalysis=function(){if(this.state.datasets[this.state.dataset].getChildByID(this.state.variable).grid_type=="scattered")return;this.refs.analysis.enabled=true;var reset=false;document.getElementById("Animation").style.visibility="hidden";for(var a in this.refs.analysis.axes)this.refs.analysis.axes[a].style.display="none";if(this.state.grid.hasAxis("x")&&this.state.grid.hasAxis("y"))this.refs.analysis.axes.xy.style.display="";for(var d=0;d<this.state.grid.response.grid.axis.length;d++){eval("this.init"+
this.state.grid.response.grid.axis[d].type.toUpperCase()+"Constraint('range',reset)");this.refs.analysis.axes[this.state.grid.response.grid.axis[d].type.toLowerCase()].style.display="";if(this.state.view.plot.indexOf(this.state.grid.response.grid.axis[d].type.toLowerCase())<0&&!this.state.analysis.axes[this.state.grid.response.grid.axis[d].type.toLowerCase()])switch(this.state.grid.response.grid.axis[d].type.toLowerCase()){case "z":this.refs.DepthWidget[this.refs.DepthWidget.widgetType][1].disabled=
true;break;case "t":if(!this.refs.DW.widgetType)this.refs.DW[1].disabled=true;else this.refs.DW.disable("hi");break}else switch(this.state.grid.response.grid.axis[d].type.toLowerCase()){case "z":this.refs.DepthWidget[this.refs.DepthWidget.widgetType][1].disabled=false;break;case "t":if(!this.refs.DW.widgetType)this.refs.DW[1].disabled=false;else this.refs.DW.enable("hi");break}}document.getElementById(this.anchors.analysis).style.display="";if(this.state.analysis.axes.x&&this.state.analysis.axes.y)this.selectAnalysisAxis(null,
"xy",true);else for(var a in this.state.analysis.axes)this.selectAnalysisAxis(null,a,true);if(this.state.analysis.type)this.selectAnalysisType(null,this.state.analysis.type,true)};
LASUI.prototype.hideAnalysis=function(){this.refs.analysis.enabled=false;var reset=false;if(!this.state.operations.response.operations.error&&this.state.grid.hasAxis("t"))for(var i=0;i<this.state.operations.getOperationCount();i++)if(this.state.operations.getOperationName(i)=="Animation")document.getElementById("Animation").style.visibility="visible";document.getElementById(this.anchors.analysis).style.display="none";for(var d=0;d<this.state.grid.response.grid.axis.length;d++)if(this.state.view.plot.indexOf(this.state.grid.response.grid.axis[d].type.toLowerCase())<
0)switch(this.state.grid.response.grid.axis[d].type.toLowerCase()){case "x":break;case "y":break;case "z":this.refs.DepthWidget[this.refs.DepthWidget.widgetType][1].disabled=false;break;case "t":if(!this.refs.DW.widgetType)this.refs.DW[1].disabled=false;else this.refs.DW.enable("hi");break}this.updateConstraints(this.state.view.plot)};
LASUI.prototype.selectAnalysisType=function(evt){if(evt){if(evt.target)var DOMNode=evt.target;else if(evt.srcElement)var DOMNode=evt.srcElement;this.state.analysis.type=DOMNode.options[DOMNode.selectedIndex].value;this.state.analysis.name=DOMNode.options[DOMNode.selectedIndex].innerHTML}if(this.state.analysis.axes.x&&this.state.analysis.axes.y)this.selectAnalysisAxis(null,"xy",true);else for(var a in this.state.analysis.axes)if(this.state.grid.hasAxis(a))this.selectAnalysisAxis(null,a,true)};
LASUI.prototype.selectAnalysisAxis=function(evt){var axes=arguments[1];if(axes==""||axes=={}||axes==null)try{axes=evt.target.value}catch(e){axes=""}if(axes==""||axes=={}||axes==null)try{axes=evt.srcElement.value}catch(e){axes=""}for(var a in this.state.analysis.axes)if(this.state.view.widgets.indexOf(a)>=0)this.state.view.widgets=this.state.view.widgets.substr(0,this.state.view.widgets.indexOf(a))+this.state.view.widgets.substr(this.state.view.widgets.indexOf(a)+1,this.state.view.widgets.length);
this.state.analysis.axes={};if(arguments[2]==true||evt){var changeVis=false;for(var i=0;i<axes.length;i++){this.state.analysis.axes[axes.charAt(i)]=true;if(this.state.view.plot.indexOf(axes.charAt(i))>=0&&this.state.analysis.type&&this.state.analysis.name!="None")changeVis=true;if(this.state.view.widgets.indexOf(axes.charAt(i))<0&&this.state.analysis.type&&this.state.analysis.name!="None")this.state.view.widgets+=axes.charAt(i)}}else;if(this.state.analysis.type&&this.state.analysis.name!="None")this.updateConstraints(this.state.view.widgets);
else this.updateConstraints(this.state.view.plot);if(changeVis)this.setVisualization(axes)};
LASUI.prototype.setVisualization=function(d){var stop=false;var bestView="";if(this.state.view.plot.indexOf(d)>=0)bestView=this.state.view.plot.substr(0,this.state.view.plot.indexOf(d))+this.state.view.plot.substr(this.state.view.plot.indexOf(d)+d.length,this.state.view.plot.length);if(bestView=="")for(var i in this.state.grid.response.grid.axis)if(d.indexOf(this.state.grid.response.grid.axis[i].type)<0)bestView=this.state.grid.response.grid.axis[i].type;for(var t in this.products)for(var p in this.products[t])if(this.products[t][p].view==
bestView&&!stop)if(this.refs.operations.plot.children[p])if(this.refs.operations.plot.children[p].radio){this.refs.operations.plot.children[p].radio.checked=true;this.refs.operations.plot.children[p].radio.onclick({srcElement:this.refs.operations.plot.children[p].radio});stop=true}this.refs.analysis.axes[d].selected=true};LASUI.prototype.collapse=function(obj){if(obj.ULNode)obj.ULNode.style.display="none";if(obj.IMGNode)obj.IMGNode.src="JavaScript/ui/plus.gif";obj.isExpanded=false};
LASUI.prototype.expand=function(obj){if(obj.ULNode)obj.ULNode.style.display="";if(obj.IMGNode)obj.IMGNode.src="JavaScript/ui/minus.gif";obj.isExpanded=true};LASUI.prototype.clone=function(obj){if(typeof obj!="object")return obj;if(obj.cloneNode)return obj.cloneNode(true);var myclone=new Object;for(var i in obj)myclone[i]=this.clone(obj[i]);return myclone};
LASUI.prototype.urlencode=function(str){var histogram={},histogram_r={},code=0,tmp_arr=[];var ret=str.toString();var replacer=function(search,replace,str){var tmp_arr=[];tmp_arr=str.split(search);return tmp_arr.join(replace)};histogram["!"]="%21";histogram["%20"]="+";ret=encodeURIComponent(ret);for(search in histogram){replace=histogram[search];ret=replacer(search,replace,ret)}return ret.replace(/(\%([a-z0-9]{2}))/g,function(full,m1,m2){return"%"+m2.toUpperCase()});return ret};var whitespace="\n\r\t ";var quotes="\"'";
function convertEscapes(str){var gt;gt=-1;while(str.indexOf("&lt;",gt+1)>-1){var gt=str.indexOf("&lt;",gt+1);var newStr=str.substr(0,gt);newStr+="<";newStr=newStr+str.substr(gt+4,str.length);str=newStr}gt=-1;while(str.indexOf("&gt;",gt+1)>-1){var gt=str.indexOf("&gt;",gt+1);var newStr=str.substr(0,gt);newStr+=">";newStr=newStr+str.substr(gt+4,str.length);str=newStr}gt=-1;while(str.indexOf("&amp;",gt+1)>-1){var gt=str.indexOf("&amp;",gt+1);var newStr=str.substr(0,gt);newStr+="&";newStr=newStr+str.substr(gt+
5,str.length);str=newStr}return str}
function convertToEscapes(str){var gt=-1;while(str.indexOf("&",gt+1)>-1){gt=str.indexOf("&",gt+1);var newStr=str.substr(0,gt);newStr+="&amp;";newStr=newStr+str.substr(gt+1,str.length);str=newStr}gt=-1;while(str.indexOf("<",gt+1)>-1){var gt=str.indexOf("<",gt+1);var newStr=str.substr(0,gt);newStr+="&lt;";newStr=newStr+str.substr(gt+1,str.length);str=newStr}gt=-1;while(str.indexOf(">",gt+1)>-1){var gt=str.indexOf(">",gt+1);var newStr=str.substr(0,gt);newStr+="&gt;";newStr=newStr+str.substr(gt+1,str.length);
str=newStr}return str}
function _displayElement(domElement,strRet){if(domElement==null)return;if(!(domElement.nodeType=="ELEMENT"))return;var tagName=domElement.tagName;var tagInfo="";tagInfo="<"+tagName;var attributeList=domElement.getAttributeNames();for(var intLoop=0;intLoop<attributeList.length;intLoop++){var attribute=attributeList[intLoop];tagInfo=tagInfo+" "+attribute+"=";tagInfo=tagInfo+'"'+domElement.getAttribute(attribute)+'"'}tagInfo=tagInfo+">";strRet=strRet+tagInfo;if(domElement.children!=null){var domElements=
domElement.children;for(var intLoop=0;intLoop<domElements.length;intLoop++){var childNode=domElements[intLoop];if(childNode.nodeType=="COMMENT")strRet=strRet+"<!--"+childNode.content+"--\>";else if(childNode.nodeType=="TEXT"){var cont=trim(childNode.content,true,true);strRet=strRet+childNode.content}else if(childNode.nodeType=="CDATA"){var cont=trim(childNode.content,true,true);strRet=strRet+"<![CDATA["+cont+"]]\>"}else strRet=_displayElement(childNode,strRet)}}strRet=strRet+"</"+tagName+">";return strRet}
function firstWhiteChar(str,pos){if(isEmpty(str))return-1;while(pos<str.length)if(whitespace.indexOf(str.charAt(pos))!=-1)return pos;else pos++;return str.length}function isEmpty(str){return str==null||str.length==0}
function trim(trimString,leftTrim,rightTrim){if(isEmpty(trimString))return"";if(leftTrim==null)leftTrim=true;if(rightTrim==null)rightTrim=true;var left=0;var right=0;var i=0;var k=0;if(leftTrim==true)while(i<trimString.length&&whitespace.indexOf(trimString.charAt(i++))!=-1)left++;if(rightTrim==true){k=trimString.length-1;while(k>=left&&whitespace.indexOf(trimString.charAt(k--))!=-1)right++}return trimString.substring(left,trimString.length-right)}
function XMLDoc(source,errFn){this.topNode=null;this.errFn=errFn;this.createXMLNode=_XMLDoc_createXMLNode;this.error=_XMLDoc_error;this.getUnderlyingXMLText=_XMLDoc_getUnderlyingXMLText;this.handleNode=_XMLDoc_handleNode;this.hasErrors=false;this.insertNodeAfter=_XMLDoc_insertNodeAfter;this.insertNodeInto=_XMLDoc_insertNodeInto;this.loadXML=_XMLDoc_loadXML;this.parse=_XMLDoc_parse;this.parseAttribute=_XMLDoc_parseAttribute;this.parseDTD=_XMLDoc_parseDTD;this.parsePI=_XMLDoc_parsePI;this.parseTag=
_XMLDoc_parseTag;this.removeNodeFromTree=_XMLDoc_removeNodeFromTree;this.replaceNodeContents=_XMLDoc_replaceNodeContents;this.selectNode=_XMLDoc_selectNode;this.selectNodeText=_XMLDoc_selectNodeText;this.source=source;if(this.parse())if(this.topNode!=null)return this.error("expected close "+this.topNode.tagName);else return true}function _XMLDoc_createXMLNode(strXML){return(new XMLDoc(strXML,this.errFn)).docNode}
function _XMLDoc_error(str){this.hasErrors=true;if(this.errFn)this.errFn("ERROR: "+str);else if(this.onerror)this.onerror("ERROR: "+str);return 0}
function _XMLDoc_getTagNameParams(tag,obj){var elm=-1,e,s=tag.indexOf("[");var attr=[];if(s>=0){e=tag.indexOf("]");if(e>=0)elm=tag.substr(s+1,e-s-1);else obj.error("expected ] near "+tag);tag=tag.substr(0,s);if(isNaN(elm)&&elm!="*"){attr=elm.substr(1,elm.length-1);attr=attr.split("=");if(attr[1]){s=attr[1].indexOf('"');attr[1]=attr[1].substr(s+1,attr[1].length-1);e=attr[1].indexOf('"');if(e>=0)attr[1]=attr[1].substr(0,e);else obj.error('expected " near '+tag)}elm=-1}else if(elm=="*")elm=-1}return[tag,
elm,attr[0],attr[1]]}function _XMLDoc_getUnderlyingXMLText(){var strRet="";strRet=strRet+'<?xml version="1.0"?>';if(this.docNode==null)return;strRet=_displayElement(this.docNode,strRet);return strRet}
function _XMLDoc_handleNode(current){if(current.nodeType=="COMMENT"&&this.topNode!=null)return this.topNode.addElement(current);else if(current.nodeType=="TEXT"||current.nodeType=="CDATA")if(this.topNode==null)if(trim(current.content,true,false)=="")return true;else return this.error("expected document node, found: "+current);else return this.topNode.addElement(current);else if(current.nodeType=="OPEN"||current.nodeType=="SINGLE"){var success=false;if(this.topNode==null){this.docNode=current;current.parent=
null;success=true}else success=this.topNode.addElement(current);if(success&&current.nodeType!="SINGLE")this.topNode=current;current.nodeType="ELEMENT";return success}else if(current.nodeType=="CLOSE")if(this.topNode==null)return this.error("close tag without open: "+current.toString());else if(current.tagName!=this.topNode.tagName)return this.error("expected closing "+this.topNode.tagName+", found closing "+current.tagName);else this.topNode=this.topNode.getParent();return true}
function _XMLDoc_insertNodeAfter(referenceNode,newNode){var parentXMLText=this.getUnderlyingXMLText();var selectedNodeXMLText=referenceNode.getUnderlyingXMLText();var originalNodePos=parentXMLText.indexOf(selectedNodeXMLText)+selectedNodeXMLText.length;var newXML=parentXMLText.substr(0,originalNodePos);newXML+=newNode.getUnderlyingXMLText();newXML+=parentXMLText.substr(originalNodePos);var newDoc=new XMLDoc(newXML,this.errFn);return newDoc}
function _XMLDoc_insertNodeInto(referenceNode,insertNode){var parentXMLText=this.getUnderlyingXMLText();var selectedNodeXMLText=referenceNode.getUnderlyingXMLText();var endFirstTag=selectedNodeXMLText.indexOf(">")+1;var originalNodePos=parentXMLText.indexOf(selectedNodeXMLText)+endFirstTag;var newXML=parentXMLText.substr(0,originalNodePos);newXML+=insertNode.getUnderlyingXMLText();newXML+=parentXMLText.substr(originalNodePos);var newDoc=new XMLDoc(newXML,this.errFn);return newDoc}
function _XMLDoc_loadXML(source){this.topNode=null;this.hasErrors=false;this.source=source;return this.parse()}
function _XMLDoc_parse(){var pos=0;err=false;while(!err){var closing_tag_prefix="";var chpos=this.source.indexOf("<",pos);var open_length=1;var open;var close;if(chpos==-1)break;open=chpos;var str=this.source.substring(pos,open);if(str.length!=0)err=!this.handleNode(new XMLNode("TEXT",this,str));if(chpos==this.source.indexOf("<?",pos)){pos=this.parsePI(this.source,pos+2);if(pos==0)err=true;continue}if(chpos==this.source.indexOf("<!DOCTYPE",pos)){pos=this.parseDTD(this.source,chpos+9);if(pos==0)err=
true;continue}if(chpos==this.source.indexOf("<!--",pos)){open_length=4;closing_tag_prefix="--"}if(chpos==this.source.indexOf("<![CDATA[",pos)){open_length=9;closing_tag_prefix="]]"}chpos=this.source.indexOf(closing_tag_prefix+">",chpos);if(chpos==-1)return this.error("expected closing tag sequence: "+closing_tag_prefix+">");close=chpos+closing_tag_prefix.length;str=this.source.substring(open+1,close);var n=this.parseTag(str);if(n)err=!this.handleNode(n);pos=close+1}return!err}
function _XMLDoc_parseAttribute(src,pos,node){while(pos<src.length&&whitespace.indexOf(src.charAt(pos))!=-1)pos++;if(pos>=src.length)return pos;var p1=pos;while(pos<src.length&&src.charAt(pos)!="=")pos++;var msg="attributes must have values";if(pos>=src.length)return this.error(msg);var paramname=trim(src.substring(p1,pos++),false,true);while(pos<src.length&&whitespace.indexOf(src.charAt(pos))!=-1)pos++;if(pos>=src.length)return this.error(msg);msg="attribute values must be in quotes";var quote=src.charAt(pos++);
if(quotes.indexOf(quote)==-1)return this.error(msg);p1=pos;while(pos<src.length&&src.charAt(pos)!=quote)pos++;if(pos>=src.length)return this.error(msg);if(!node.addAttribute(paramname,trim(src.substring(p1,pos++),false,true)))return 0;return pos}
function _XMLDoc_parseDTD(str,pos){var firstClose=str.indexOf(">",pos);if(firstClose==-1)return this.error("error in DTD: expected '>'");var closing_tag_prefix="";var firstOpenSquare=str.indexOf("[",pos);if(firstOpenSquare!=-1&&firstOpenSquare<firstClose)closing_tag_prefix="]";while(true){var closepos=str.indexOf(closing_tag_prefix+">",pos);if(closepos==-1)return this.error("expected closing tag sequence: "+closing_tag_prefix+">");pos=closepos+closing_tag_prefix.length+1;if(str.substring(closepos-
1,closepos+2)!="]]\>")break}return pos}function _XMLDoc_parsePI(str,pos){var closepos=str.indexOf("?>",pos);return closepos+2}
function _XMLDoc_parseTag(src){if(src.indexOf("!--")==0)return new XMLNode("COMMENT",this,src.substring(3,src.length-2));if(src.indexOf("![CDATA[")==0)return new XMLNode("CDATA",this,src.substring(8,src.length-2));var n=new XMLNode;n.doc=this;if(src.charAt(0)=="/"){n.nodeType="CLOSE";src=src.substring(1)}else n.nodeType="OPEN";if(src.charAt(src.length-1)=="/"){if(n.nodeType=="CLOSE")return this.error("singleton close tag");else n.nodeType="SINGLE";src=src.substring(0,src.length-1)}if(n.nodeType!=
"CLOSE")n.attributes=new Array;if(n.nodeType=="OPEN")n.children=new Array;src=trim(src,true,true);if(src.length==0)return this.error("empty tag");var endOfName=firstWhiteChar(src,0);if(endOfName==-1){n.tagName=src;return n}n.tagName=src.substring(0,endOfName);var pos=endOfName;while(pos<src.length){pos=this.parseAttribute(src,pos,n);if(this.pos==0)return null}return n}
function _XMLDoc_removeNodeFromTree(node){var parentXMLText=this.getUnderlyingXMLText();var selectedNodeXMLText=node.getUnderlyingXMLText();var originalNodePos=parentXMLText.indexOf(selectedNodeXMLText);var newXML=parentXMLText.substr(0,originalNodePos);newXML+=parentXMLText.substr(originalNodePos+selectedNodeXMLText.length);var newDoc=new XMLDoc(newXML,this.errFn);return newDoc}
function _XMLDoc_replaceNodeContents(referenceNode,newContents){var newNode=this.createXMLNode("<X>"+newContents+"</X>");referenceNode.children=newNode.children;return this}
function _XMLDoc_selectNode(tagpath){tagpath=trim(tagpath,true,true);var srcnode,node,tag,params,elm,rg;var tags,attrName,attrValue,ok;srcnode=node=this.source?this.docNode:this;if(!tagpath)return node;if(tagpath.indexOf("/")==0)tagpath=tagpath.substr(1);tagpath=tagpath.replace(tag,"");tags=tagpath.split("/");tag=tags[0];if(tag){if(tagpath.indexOf("/")==0)tagpath=tagpath.substr(1);tagpath=tagpath.replace(tag,"");params=_XMLDoc_getTagNameParams(tag,this);tag=params[0];elm=params[1];attrName=params[2];
attrValue=params[3];node=tag=="*"?node.getElements():node.getElements(tag);if(node.length)if(elm<0){srcnode=node;var i=0;while(i<srcnode.length){if(attrName)if(srcnode[i].getAttribute(attrName)!=attrValue)ok=false;else ok=true;else ok=true;if(ok){node=srcnode[i].selectNode(tagpath);if(node)return node}i++}}else if(elm<node.length){node=node[elm].selectNode(tagpath);if(node)return node}}}
function _XMLDoc_selectNodeText(tagpath){var node=this.selectNode(tagpath);if(node!=null)return node.getText();else return null}
function XMLNode(nodeType,doc,str){if(nodeType=="TEXT"||nodeType=="CDATA"||nodeType=="COMMENT")this.content=str;else this.content=null;this.attributes=null;this.children=null;this.doc=doc;this.nodeType=nodeType;this.parent="";this.tagName="";this.addAttribute=_XMLNode_addAttribute;this.addElement=_XMLNode_addElement;this.getAttribute=_XMLNode_getAttribute;this.getAttributeNames=_XMLNode_getAttributeNames;this.getElementById=_XMLNode_getElementById;this.getElements=_XMLNode_getElements;this.getText=
_XMLNode_getText;this.getParent=_XMLNode_getParent;this.getUnderlyingXMLText=_XMLNode_getUnderlyingXMLText;this.removeAttribute=_XMLNode_removeAttribute;this.selectNode=_XMLDoc_selectNode;this.selectNodeText=_XMLDoc_selectNodeText;this.toString=_XMLNode_toString}function _XMLNode_addAttribute(attributeName,attributeValue){this.attributes["_"+attributeName]=attributeValue;return true}function _XMLNode_addElement(node){node.parent=this;this.children[this.children.length]=node;return true}
function _XMLNode_getAttribute(name){if(this.attributes==null)return null;return this.attributes["_"+name]}function _XMLNode_getAttributeNames(){if(this.attributes==null){var ret=new Array;return ret}var attlist=new Array;for(var a in this.attributes)if(typeof this.attributes[a]!=="function")attlist[attlist.length]=a.substring(1);return attlist}
function _XMLNode_getElementById(id){var node=this;var ret;if(node.getAttribute("id")==id)return node;else{var elements=node.getElements();var intLoop=0;while(intLoop<elements.length){var element=elements[intLoop];ret=element.getElementById(id);if(ret!=null)break;intLoop++}}return ret}
function _XMLNode_getElements(byName){if(this.children==null){var ret=new Array;return ret}var elements=new Array;for(var i=0;i<this.children.length;i++)if(this.children[i].nodeType=="ELEMENT"&&(byName==null||this.children[i].tagName==byName))elements[elements.length]=this.children[i];return elements}
function _XMLNode_getText(){if(this.nodeType=="ELEMENT"){if(this.children==null)return null;var str="";for(var i=0;i<this.children.length;i++){var t=this.children[i].getText();str+=t==null?"":t}return str}else if(this.nodeType=="TEXT")return convertEscapes(this.content);else return this.content}function _XMLNode_getParent(){return this.parent}function _XMLNode_getUnderlyingXMLText(){var strRet="";strRet=_displayElement(this,strRet);return strRet}
function _XMLNode_removeAttribute(attributeName){if(attributeName==null)return this.doc.error("You must pass an attribute name into the removeAttribute function");var attributes=this.getAttributeNames();var intCount=attributes.length;var tmpAttributeValues=new Array;for(intLoop=0;intLoop<intCount;intLoop++)tmpAttributeValues[intLoop]=this.getAttribute(attributes[intLoop]);this.attributes=new Array;for(intLoop=0;intLoop<intCount;intLoop++)if(attributes[intLoop]!=attributeName)this.addAttribute(attributes[intLoop],
tmpAttributeValues[intLoop]);return true}function _XMLNode_toString(){return""+this.nodeType+":"+(this.nodeType=="TEXT"||this.nodeType=="CDATA"||this.nodeType=="COMMENT"?this.content:this.tagName)};function LASRequest(xml){if(!xml)xml='<?xml version="1.0"?><lasRequest href="file:las.xml"><link match="/lasdata/operations/shade"/><args><link match="/lasdata/datasets/coads_climatology_cdf/variables/airt"></link><region><range type="x" low="-180.0" high="180.0"/><range type="y" low="-89.5" high="89.5"/><point type="t" v="15-Jan"/></region></args></lasRequest>';this.DOM=new XMLDoc(xml,_LASReq_parseError);var operationNode=this.DOM.selectNode("/link");if(!this.DOM.selectNode("/properties")){var newNode=
this.DOM.createXMLNode("<properties></properties>");this.DOM=this.DOM.insertNodeAfter(operationNode,newNode)}this.getOperation=LASReq_getOperation;this.setOperation=LASReq_setOperation;this.addPropertyGroup=LASReq_addPropertyGroup;this.removePropertyGroup=LASReq_removePropertyGroup;this.getProperty=LASReq_getProperty;this.setProperty=LASReq_setProperty;this.addProperty=LASReq_addProperty;this.removeProperty=LASReq_removeProperty;this.getVariable=LASReq_getVariable;this.setVariable=LASReq_setVariable;
this.addVariable=LASReq_addVariable;this.removeVariable=LASReq_removeVariable;this.removeVariables=LASReq_removeVariables;this.replaceVariable=LASReq_replaceVariable;this.getDataset=LASReq_getDataset;this.addTextConstraint=LASReq_addTextConstraint;this.addVariableConstraint=LASReq_addVariableConstraint;this.removeConstraints=LASReq_removeConstraints;this.getTextConstraints=LASReq_getTextConstraints;this.getVariableConstraints=LASReq_getVariableConstraints;this.setAnalysis=LASReq_setAnalysis;this.getAnalysis=
LASReq_getAnalysis;this.removeAnalysis=LASReq_removeAnalysis;this.addRegion=LASReq_addRegion;this.removeRegion=LASReq_removeRegion;this.getRangeLo=LASReq_getRangeLo;this.getRangeHi=LASReq_getRangeHi;this.getAxisType=LASReq_getAxisType;this.setRange=LASReq_setRange;this.addRange=LASReq_addRange;this.removeRange=LASReq_removeRange;this.getXMLText=LASReq_getXMLText;this.getVariableNode=LASReq_getVariableNode;this.getVariableNodeByIndex=LASReq_getVariableNodeByIndex}
function LASReq_getOperation(style){var operationNode=this.DOM.selectNode("/link");var matchString=new String(operationNode.getAttribute("match"));var pieces=matchString.split("/");var operation="";if(style=="LAS6")operation=pieces[3];else{var operationIDString=new String(pieces[3]);var subpieces=operationIDString.split("'");operation=subpieces[1];if(!operation)operation=this.getOperation("LAS6")}return operation}
function LASReq_setOperation(operation,style){var linkMatch="";if(style=="LAS6")linkMatch="/lasdata/operations/"+operation;else linkMatch="/lasdata/operations/operation[@ID='"+operation+"']";var operationNode=this.DOM.selectNode("/link");operationNode.removeAttribute("match");operationNode.addAttribute("match",linkMatch)}
function LASReq_addPropertyGroup(group){if(!this.DOM.selectNode("/properties")){var newNode=this.DOM.createXMLNode("<properties></properties>");this.DOM=this.DOM.insertNodeAfter(operationNode,newNode)}var propertiesNode=this.DOM.selectNode("/properties");var nodePath="/properties/"+group;if(!this.DOM.selectNode(nodePath)){var nodeXML="<"+group+">"+"</"+group+">";var newNode=this.DOM.createXMLNode(nodeXML);this.DOM=this.DOM.insertNodeInto(propertiesNode,newNode)}}
function LASReq_removePropertyGroup(group){var nodePath="/properties/"+group;var propertyGroupNode=this.DOM.selectNode(nodePath);if(propertyGroupNode)this.DOM=this.DOM.removeNodeFromTree(propertyGroupNode)}function LASReq_getProperty(group,property){var nodePath="/properties/"+group+"/"+property;var propertyNode=this.DOM.selectNode(nodePath);if(propertyNode)return this.DOM.selectNodeText(nodePath);else return null}
function LASReq_setProperty(group,property,value){var nodePath="/properties/"+group+"/"+property;var propertyNode=this.DOM.selectNode(nodePath);if(propertyNode)this.DOM=this.DOM.replaceNodeContents(propertyNode,value);else this.addProperty(group,property,value)}
function LASReq_addProperty(group,property,value){var parentPath="/properties/"+group;var parentNode=this.DOM.selectNode(parentPath);if(!parentNode)this.addPropertyGroup(group);var nodePath="/properties/"+group+"/"+property;var propertyNode=this.DOM.selectNode(nodePath);if(propertyNode)this.setProperty(group,property,value);else{var parentPath="/properties/"+group;var parentNode=this.DOM.selectNode(parentPath);var nodeXML="<"+property+">"+value+"</"+property+">";var newNode=this.DOM.createXMLNode(nodeXML);
this.DOM=this.DOM.insertNodeInto(parentNode,newNode)}}function LASReq_removeProperty(group,property){var nodePath="/properties/"+group+"/"+property;var propertyNode=this.DOM.selectNode(nodePath);if(propertyNode)this.DOM=this.DOM.removeNodeFromTree(propertyNode)}function LASReq_getDataset(data_ID){var index=data_ID?data_ID:0;var variableNode=this.DOM.selectNode("/args/link["+index+"]");matchString=new String(variableNode.getAttribute("match"));var pieces=matchString.split("/");return pieces[3]}
function LASReq_getVariable(data_ID){var index=data_ID?data_ID:0;var variableNode=this.DOM.selectNode("/args/link["+index+"]");if(variableNode){matchString=new String(variableNode.getAttribute("match"));var pieces=matchString.split("/");return pieces[5]}else return}function LASReq_setVariable(dataset,variable){this.removeVariables();this.addVariable(dataset,variable)}
function LASReq_addVariable(dataset,variable){var nodeXML='<link match="/lasdata/datasets/'+dataset+"/variables/"+variable+'"></link>';var newNode=this.DOM.createXMLNode(nodeXML);var argsNode=this.DOM.selectNode("/args");var childNodes=argsNode.getElements();if(childNodes.length==0)this.DOM=this.DOM.insertNodeInto(argsNode,newNode);else{var lastIndex=childNodes.length-1;var lastChildNode=childNodes[lastIndex];this.DOM=this.DOM.insertNodeAfter(lastChildNode,newNode)}}
function LASReq_OLD_removeVariable(dataset,variable){var argsNode=this.DOM.selectNode("/args");var variableNodes=argsNode.getElements("link");for(i=0;i<variableNodes.length;i++){matchString=new String(variableNodes[i].getAttribute("match"));var pieces=matchString.split("/");if(pieces[5]==variable)this.DOM=this.DOM.removeNodeFromTree(variableNodes[i])}}
function LASReq_removeVariable(data_ID){var index=data_ID?data_ID:0;var argsNode=this.DOM.selectNode("/args");var variableNodes=argsNode.getElements("link");if(variableNodes.length>index)this.DOM=this.DOM.removeNodeFromTree(variableNodes[index])}function LASReq_removeVariables(){var argsNode=this.DOM.selectNode("/args");var variableNodes=argsNode.getElements("link");for(i=0;i<variableNodes.length;i++)this.DOM=this.DOM.removeNodeFromTree(variableNodes[i])}
function LASReq_replaceVariable(dataset,variable,data_ID){var nodeXML='<link match="/lasdata/datasets/'+dataset+"/variables/"+variable+'"></link>';var newNode=this.DOM.createXMLNode(nodeXML);var index=data_ID?data_ID:0;var oldNode=this.DOM.selectNode("/args/link["+index+"]");this.DOM=this.DOM.insertNodeAfter(oldNode,newNode);this.DOM=this.DOM.removeNodeFromTree(oldNode)}
function LASReq_addTextConstraint(variable,operator,value,id){var argsNode=this.DOM.selectNode("/args");var nodeXML='<constraint id="'+id+'"type="text"><v>'+variable+"</v><v>"+operator+"</v><v>"+value+"</v></constraint>";var newNode=this.DOM.createXMLNode(nodeXML);this.DOM=this.DOM.insertNodeInto(argsNode,newNode)}
function LASReq_getTextConstraints(){var textConstraints=new Array;var argsNode=this.DOM.selectNode("/args");var constraintNodes=argsNode.getElements("constraint");var j=0;for(i=0;i<constraintNodes.length;i++){constraintType=new String(constraintNodes[i].getAttribute("type"));if(constraintNodes[i].getAttribute("id"))var constraintID=constraintNodes[i].getAttribute("id");else var constraintID="";if(constraintType=="text"){var vNodes=constraintNodes[i].getElements("v");tc={name:vNodes[0].getText(),
op:vNodes[1].getText(),value:vNodes[2].getText(),id:constraintID};textConstraints[j++]=tc}}return textConstraints}
function LASReq_getVariableConstraints(){var variableConstraints=new Array;var argsNode=this.DOM.selectNode("/args");var constraintNodes=argsNode.getElements("constraint");var j=0;for(i=0;i<constraintNodes.length;i++){constraintType=new String(constraintNodes[i].getAttribute("type"));if(constraintNodes[i].getAttribute("id"))var constraintID=constraintNodes[i].getAttribute("id");else var constraintID="";if(constraintType=="variable"){var the_link=constraintNodes[i].getElements("link");var matchString=
new String(the_link[0].getAttribute("match"));var pieces=matchString.split("/");var the_dsID=pieces[3];var the_varID=pieces[5];var the_op=constraintNodes[i].getAttribute("op");var vNodes=constraintNodes[i].getElements("v");var the_value=vNodes[0].getText();vc={dsID:the_dsID,varID:the_varID,op:the_op,value:the_value,id:constraintID};variableConstraints[j++]=vc}}return variableConstraints}
function LASReq_addVariableConstraint(dataset,variable,operator,value,id){var argsNode=this.DOM.selectNode("/args");var linkXML='<link match="/lasdata/datasets/'+dataset+"/variables/"+variable+'"/>';var nodeXML='<constraint id="'+id+'" type="variable" op="'+operator+'">'+linkXML+"<v>"+value+"</v></constraint>";var newNode=this.DOM.createXMLNode(nodeXML);this.DOM=this.DOM.insertNodeInto(argsNode,newNode)}
function LASReq_removeConstraints(){var argsNode=this.DOM.selectNode("/args");var constraintNodes=argsNode.getElements("constraint");for(i=0;i<constraintNodes.length;i++)this.DOM=this.DOM.removeNodeFromTree(constraintNodes[i])}
function LASReq_getAnalysis(index){var Analysis=null;var variableNode=this.getVariableNodeByIndex(index);if(variableNode){var analysisNode=variableNode.getElements("analysis")[0];if(analysisNode){Analysis=new Object;Analysis.axis=[];Analysis.label=String(analysisNode.getAttribute("label"));var axisNodes=analysisNode.getElements("axis");for(i=0;i<axisNodes.length;i++){Analysis.axis[i]=Object;Analysis.axis[i].type=String(axisNodes[i].getAttribute("type"));Analysis.axis[i].lo=String(axisNodes[i].getAttribute("lo"));
Analysis.axis[i].hi=String(axisNodes[i].getAttribute("hi"));Analysis.axis[i].op=String(axisNodes[i].getAttribute("op"))}}else Analysis=null}else Analysis=null;return Analysis}
function LASReq_setAnalysis(index,A){var variableNode=this.getVariableNodeByIndex(index);var nodeXML='<analysis label="'+A.label+'"></analysis>';var AnalysisNode=this.DOM.createXMLNode(nodeXML);for(i=0;i<A.axis.length;i++){var nodeXML='<axis type="'+A.axis[i].type+'" lo="'+A.axis[i].lo+'" hi="'+A.axis[i].hi+'" op="'+A.axis[i].op+'"/>';var AxisNode=this.DOM.createXMLNode(nodeXML);AnalysisNode.addElement(AxisNode)}this.DOM=this.DOM.insertNodeInto(variableNode,AnalysisNode)}
function LASReq_removeAnalysis(index){var variableNode=this.getVariableNodeByIndex(index);var analysisNodes=variableNode.getElements("analysis");for(i=0;i<analysisNodes.length;i++)this.DOM=this.DOM.removeNodeFromTree(analysisNodes[i])}
function LASReq_addRegion(){var nodeXML="<region></region>";var newNode=this.DOM.createXMLNode(nodeXML);var argsNode=this.DOM.selectNode("/args");var childNodes=argsNode.getElements();if(childNodes.length==0)this.DOM=this.DOM.insertNodeInto(argsNode,newNode);else{var lastIndex=childNodes.length-1;var lastChildNode=childNodes[lastIndex];this.DOM=this.DOM.insertNodeAfter(lastChildNode,newNode)}}
function LASReq_removeRegion(region_ID){var index=region_ID?region_ID:0;var argsNode=this.DOM.selectNode("/args");var regionNodes=argsNode.getElements("region");if(regionNodes.length>index)this.DOM=this.DOM.removeNodeFromTree(regionNodes[index])}
function LASReq_getRangeLo(xyzt,region_ID){var lo=null;var type=this.getAxisType(xyzt,region_ID);if(type=="range"){var index=region_ID?region_ID:0;var axisNode=this.DOM.selectNode("/args/region["+index+']/range[@type="'+xyzt+'"]');lo=axisNode.getAttribute("low")}else if(type=="point"){var index=region_ID?region_ID:0;var axisNode=this.DOM.selectNode("/args/region["+index+']/point[@type="'+xyzt+'"]');lo=axisNode.getAttribute("v")}else lo=null;return lo}
function LASReq_getRangeHi(xyzt,region_ID){var hi=null;var type=this.getAxisType(xyzt,region_ID);if(type=="range"){var index=region_ID?region_ID:0;var axisNode=this.DOM.selectNode("/args/region["+index+']/range[@type="'+xyzt+'"]');hi=axisNode.getAttribute("high")}else hi=null;return hi}
function LASReq_getAxisType(xyzt,region_ID){var type=null;var index=region_ID?region_ID:0;var axisNode=this.DOM.selectNode("/args/region["+index+']/range[@type="'+xyzt+'"]');if(axisNode)type="range";else{axisNode=this.DOM.selectNode("/args/region["+index+']/point[@type="'+xyzt+'"]');if(axisNode)type="point"}return type}function LASReq_setRange(xyzt,lo,hi,region_ID){this.removeRange(xyzt,region_ID);this.addRange(xyzt,lo,hi,region_ID)}
function LASReq_addRange(xyzt,lo,hi,region_ID){var index=region_ID?region_ID:0;var regionNode=this.DOM.selectNode("/args/region["+index+"]");if(!regionNode)this.addRegion();var nodeXML="";if(hi!=null&&hi!=lo)nodeXML='<range type="'+xyzt+'" low="'+lo+'" high="'+hi+'"/>';else nodeXML='<point type="'+xyzt+'" v="'+lo+'"/>';var newNode=this.DOM.createXMLNode(nodeXML);regionNode=this.DOM.selectNode("/args/region["+index+"]");this.DOM=this.DOM.insertNodeInto(regionNode,newNode)}
function LASReq_removeRange(xyzt,region_ID){var index=region_ID?region_ID:0;var regionNode=this.DOM.selectNode("/args/region["+index+"]");if(regionNode){var axisNode=this.DOM.selectNode("/args/region["+index+']/range[@type="'+xyzt+'"]');if(axisNode)this.DOM=this.DOM.removeNodeFromTree(axisNode);else{var axisNode=this.DOM.selectNode("/args/region["+index+']/point[@type="'+xyzt+'"]');if(axisNode)this.DOM=this.DOM.removeNodeFromTree(axisNode)}}}
function LASReq_getXMLText(){return this.DOM.getUnderlyingXMLText()}function LASReq_getVariableNode(dataset,variable){var argsNode=this.DOM.selectNode("/args");var variableNodes=argsNode.getElements("link");for(i=0;i<variableNodes.length;i++){matchString=new String(variableNodes[i].getAttribute("match"));var pieces=matchString.split("/");if(pieces[5]==variable)return variableNodes[i]}}
function LASReq_getVariableNodeByIndex(index){var argsNode=this.DOM.selectNode("/args");var variableNodes=argsNode.getElements("link");if(variableNodes[index])return variableNodes[index];else return null}function _LASReq_parseError(e){alert(e)};function LASGetGridResponse(response){this.response=response;this.hasAxis=LASGetGridResponse_hasAxis;this.hasArange=LASGetGridResponse_hasArange;this.hasMenu=LASGetGridResponse_hasMenu;this.getAxis=LASGetGridResponse_getAxis;this.getLo=LASGetGridResponse_getLo;this.getHi=LASGetGridResponse_getHi;this.getDelta=LASGetGridResponse_getDelta;this.getSize=LASGetGridResponse_getSize;this.getUnits=LASGetGridResponse_getUnits;this.getID=LASGetGridResponse_getID;this.getDisplayType=LASGetGridResponse_getDisplayType;
this.getRenderFormat=LASGetGridResponse_getRenderFormat;this.getMenu=LASGetGridResponse_getMenu;if(response==null){var error_string="getGrid.do returned a null response.";throw error_string;}else if(response.status!="ok"){var error_string=response.error?response.error:"Unknown error in LASGetGridResponse.";throw error_string;}}
function LASGetGridResponse_getAxis(axis){var axis_lc=String(axis).toLowerCase();var value=null;for(var i=0;i<this.response.grid.axis.length;i++)if(this.response.grid.axis[i].type==axis_lc)value=this.response.grid.axis[i];return value}function LASGetGridResponse_hasAxis(axis){var axis_lc=String(axis).toLowerCase();var value=false;if(this.getAxis(axis_lc))value=true;return value}
function LASGetGridResponse_hasArange(axis){var axis_lc=String(axis).toLowerCase();var value=false;if(this.hasAxis(axis_lc))if(this.getAxis(axis_lc).arange)value=true;return value}function LASGetGridResponse_hasMenu(axis){var axis_lc=String(axis).toLowerCase();var value=false;if(this.hasAxis(axis_lc))if(this.getAxis(axis_lc).v)value=true;return value}
function LASGetGridResponse_getLo(axis){var axis_lc=String(axis).toLowerCase();var value=null;if(axis_lc=="t")value=this.getAxis(axis_lc).lo;else if(this.hasMenu(axis))value=this.getAxis(axis_lc).v[0];else{var start=Number(this.getAxis(axis_lc).arange.start);var size=Number(this.getAxis(axis_lc).arange.size);var step=Number(this.getAxis(axis_lc).arange.step);if(step<0)value=start+(size-1)*step;else value=start}return value}
function LASGetGridResponse_getHi(axis){var axis_lc=String(axis).toLowerCase();var value=null;if(axis_lc=="t")value=this.getAxis(axis_lc).hi;else if(this.hasMenu(axis)){var index=this.getAxis(axis_lc).v.length-1;value=this.getAxis(axis_lc).v[index]}else{var start=Number(this.getAxis(axis_lc).arange.start);var size=Number(this.getAxis(axis_lc).arange.size);var step=Number(this.getAxis(axis_lc).arange.step);if(step<0)value=start;else value=start+(size-1)*step}return value}
function LASGetGridResponse_getDelta(axis){var axis_lc=String(axis).toLowerCase();var value=null;if(this.hasArange(axis_lc))value=this.getAxis(axis_lc).arange.step;return Number(value)}function LASGetGridResponse_getSize(axis){var axis_lc=String(axis).toLowerCase();var value=null;if(this.hasArange(axis_lc))value=this.getAxis(axis_lc).arange.size;else if(this.hasMenu(axis))value=this.getAxis(axis_lc).v.length;return Number(value)}
function LASGetGridResponse_getUnits(axis){var value=null;var axis_lc=String(axis).toLowerCase();if(this.hasAxis(axis_lc))value=this.getAxis(axis_lc).units;return value}function LASGetGridResponse_getID(axis){var value=null;var axis_lc=String(axis).toLowerCase();if(this.hasAxis(axis_lc))value=this.getAxis(axis_lc).display_type;return value}
function LASGetGridResponse_getDisplayType(axis){var axis_lc=String(axis).toLowerCase();var value=null;if(this.hasAxis(axis))if(this.getAxis(axis_lc).display_type)value=this.getAxis(axis_lc).display_type;return value}
function LASGetGridResponse_getRenderFormat(axis){var axis_lc=String(axis).toLowerCase();var value=null;switch(axis_lc){case "t":value="";if(this.getAxis("t").yearNeeded=="true")value+="Y";if(this.getAxis("t").monthNeeded=="true")value+="M";if(this.getAxis("t").dayNeeded=="true")value+="D";if(this.getAxis("t").hourNeeded=="true")value+="T";break}return value}
function LASGetGridResponse_getMenu(axis){var axis_lc=String(axis).toLowerCase();var value=null;var menu=null;if(this.getAxis(axis_lc).v){value=new Array;menu=this.getAxis(axis_lc).v;for(var i=0;i<menu.length;i++)if(axis_lc=="t"){var month_name=String(menu[i].content).toLowerCase();if(month_name=="jan")menu[i].content="15-Jan";if(month_name=="feb")menu[i].content="15-Feb";if(month_name=="mar")menu[i].content="15-Mar";if(month_name=="apr")menu[i].content="15-Apr";if(month_name=="may")menu[i].content=
"15-May";if(month_name=="jun")menu[i].content="15-Jun";if(month_name=="jul")menu[i].content="15-Jul";if(month_name=="aug")menu[i].content="15-Aug";if(month_name=="sep")menu[i].content="15-Sep";if(month_name=="oct")menu[i].content="15-Oct";if(month_name=="nov")menu[i].content="15-Nov";if(month_name=="dec")menu[i].content="15-Dec";value[i]=new Array(menu[i].label,menu[i].content)}else value[i]=new Array(menu[i],menu[i])}return value};function LASGetCategoriesResponse(JSONObject){this.response=JSONObject;if(!this.response)return false;this.getDatasetID=LASGetCategoriesResponse_getDatasetID;this.getCategoryType=LASGetCategoriesResponse_getCategoryType;this.getCategorySize=LASGetCategoriesResponse_getCategorySize;this.getChild=LASGetCategoriesResponse_getChild;this.getChildrenType=LASGetCategoriesResponse_getChildrenType;this.getChildID=LASGetCategoriesResponse_getChildID;this.getChildDatasetID=LASGetCategoriesResponse_getChildDatasetID;
this.getDatasetName=LASGetCategoriesResponse_getDatasetName;this.getChildType=LASGetCategoriesResponse_getChildType;this.getChildByID=LASGetCategoriesResponse_getChildByID;this.getChildChildrenType=LASGetCategoriesResponse_getChildChildrenType;this.getChildName=LASGetCategoriesResponse_getChildName}
function LASGetCategoriesResponse_getCategoryType(){if(this.response.categories.category)if(this.response.categories.category[0])if(this.response.categories.category[0].dataset)return"dataset";else return"category";else return null;else return null}
function LASGetCategoriesResponse_getDatasetID(i){if(i==null)i=0;if(this.getCategoryType()=="dataset"){var ct=0;var len=this.response.categories.category[0].dataset.length;if(!len)len=1;for(d=0;d<len;d++)if(len==1)return this.response.categories.category[0].dataset.ID;else if(this.response.categories.category[0].dataset[d].variables)if(this.response.categories.category[0].dataset[d].variables.variable){lastct=ct;ct+=this.response.categories.category[0].dataset[d].variables.variable.length;if(i>=lastct&&
i<ct)return this.response.categories.category[0].dataset[d].ID}}else return"category"}function LASGetCategoriesResponse_getDatasetName(){if(this.getCategoryType()=="dataset")if(this.response.categories.category[0].dataset.name)return this.response.categories.category[0].dataset.name;else{if(this.response.categories.category[0].name)return this.response.categories.category[0].name}else return"category"}
function LASGetCategoriesResponse_getCategorySize(){if(this.getCategoryType()=="dataset"){var ct=0;var len=this.response.categories.category[0].dataset.length;if(!len)len=1;for(i=0;i<len;i++)if(len==1){if(this.response.categories.category[0].dataset.variables.variable)ct+=this.response.categories.category[0].dataset.variables.variable.length}else if(this.response.categories.category[0].dataset[i].variables)if(this.response.categories.category[0].dataset[i].variables.variable)ct+=this.response.categories.category[0].dataset[i].variables.variable.length;
return ct}else if(this.response.categories[this.getCategoryType()])return this.response.categories[this.getCategoryType()].length;else return false}
function LASGetCategoriesResponse_getChild(i){if(this.getCategoryType()=="dataset"){var ct=0;var len=this.response.categories.category[0].dataset.length;if(!len)len=1;for(d=0;d<len;d++)if(len==1){if(this.response.categories.category[0].dataset.variables.variable)if(this.response.categories.category[0].dataset.variables.variable){lastct=ct;ct+=this.response.categories.category[0].dataset.variables.variable.length;if(i>=lastct&&i<ct)return this.response.categories.category[0].dataset.variables.variable[i-
lastct]}}else if(this.response.categories.category[0].dataset[d].variables)if(this.response.categories.category[0].dataset[d].variables.variable){lastct=ct;ct+=this.response.categories.category[0].dataset[d].variables.variable.length;if(i>=lastct&&i<ct)return this.response.categories.category[0].dataset[d].variables.variable[i-lastct]}}else if(this.response.categories[this.getCategoryType()]);return this.response.categories[this.getCategoryType()][i];return false}
function LASGetCategoriesResponse_getChildrenType(i){switch(this.getCategoryType()){case "category":return"categories";break;case "dataset":return"variables";break;default:return false}}function LASGetCategoriesResponse_getChildType(i){switch(this.getChildChildrenType(i)){case "variables":return"dataset";break;case "categories":return"category";break;default:return false}}
function LASGetCategoriesResponse_getChildChildrenType(i){if(this.getChild(i).children)return this.getChild(i).children;else return false}function LASGetCategoriesResponse_getChildID(i){if(this.getChild(i).ID)return this.getChild(i).ID}function LASGetCategoriesResponse_getChildDatasetID(i){if(this.getChild(i).children_dsid)return this.getChild(i).children_dsid}function LASGetCategoriesResponse_getChildName(i){if(this.getChild(i).ID)return this.getChild(i).name}
function LASGetCategoriesResponse_getChildByID(ID){for(var i=0;i<this.getCategorySize();i++)if(this.getChildID(i)==ID)return this.getChild(i)};function LASGetDataConstraintsResponse(JSONObject){this.response=JSONObject;if(!this.response)return false;this.getConstraintID=LASGetDataConstraintsResponse_getConstraintID;this.getConstraintType=LASGetDataConstraintsResponse_getConstraintType;this.getConstraintSize=LASGetDataConstraintsResponse_getConstraintSize;this.getChild=LASGetDataConstraintsResponse_getChild;this.getChildrenType=LASGetDataConstraintsResponse_getChildrenType;this.getChildID=LASGetDataConstraintsResponse_getChildID;this.getChildType=
LASGetDataConstraintsResponse_getChildType;this.getChildName=LASGetDataConstraintsResponse_getChildName}function LASGetDataConstraintsResponse_getConstraintType(){if(this.response.DataConstraints.Constraint)if(this.response.DataConstraints.Constraint[0])if(this.response.DataConstraints.Constraint[0].dataset)return"dataset";else return"Constraint";else return null;else return null}
function LASGetDataConstraintsResponse_getConstraintID(){if(this.getConstraintType()=="dataset")return this.response.DataConstraints.Constraint[0].constraint.ID;else return"Constraint"}
function LASGetDataConstraintsResponse_getConstraintSize(){if(this.getConstraintType()=="dataset"){if(this.response.DataConstraints.Constraint[0].dataset.variables.variable)return this.response.DataConstraints.Constraint[0].dataset.variables.variable.length}else if(this.response.DataConstraints[this.getConstraintType()])return this.response.DataConstraints[this.getConstraintType()].length;else return false}
function LASGetDataConstraintsResponse_getChild(i){if(this.getConstraintType()=="dataset")return this.response.DataConstraints.Constraint[0].dataset.variables.variable[i];else if(this.response.DataConstraints[this.getConstraintType()]);return this.response.DataConstraints[this.getConstraintType()][i];return false}
function LASGetDataConstraintsResponse_getChildrenType(i){switch(this.getConstraintType()){case "Constraint":return"DataConstraints";break;case "dataset":return"variables";break;default:return false}}function LASGetDataConstraintsResponse_getChildType(i){switch(this.getChildChildrenType(i)){case "variables":return"dataset";break;case "DataConstraints":return"Constraint";break;default:return false}}
function LASGetDataConstraintsResponse_getChildID(i){if(this.getChild(i).ID)return this.getChild(i).ID}function LASGetDataConstraintsResponse_getChildName(i){if(this.getChild(i).ID)return this.getChild(i).name};function LASGetViewsResponse(JSONObject){this.response=JSONObject;if(!this.response)return false;this.getAllViews=LASGetViewsResponse_getAllViews;this.getViewCount=LASGetViewsResponse_getViewCount;this.getView=LASGetViewsResponse_getView;this.getViewID=LASGetViewsResponse_getViewID;this.getViewByID=LASGetViewsResponse_getViewByID;this.getViewName=LASGetViewsResponse_getViewName}
function LASGetViewsResponse_getAllViews(){if(this.response.views.view)return this.response.views.view;else return null}function LASGetViewsResponse_getViewCount(){if(this.getAllViews())return this.getAllViews().length;else return-1}function LASGetViewsResponse_getView(i){if(i>=0&&i<this.getViewCount())return this.getAllViews()[i];else return null}function LASGetViewsResponse_getViewID(i){if(this.getView(i))return this.getView(i).value;else return null}
function LASGetViewsResponse_getViewByID(id){for(var i=0;i<this.getViewCount();i++)if(this.getView(i).value==id)return this.getView(i);return null}function LASGetViewsResponse_getViewName(i){if(this.getView(i))return this.getView(i).name;else return null};function LASGetOperationsResponse(JSONObject){this.response=JSONObject;if(!this.response)return false;this.getAllOperations=LASGetOperationsResponse_getAllOperations;this.getOperationCount=LASGetOperationsResponse_getOperationCount;this.getOperation=LASGetOperationsResponse_getOperation;this.getOperationID=LASGetOperationsResponse_getOperationID;this.getOperationByID=LASGetOperationsResponse_getOperationByID;this.getOperationName=LASGetOperationsResponse_getOperationName}
function LASGetOperationsResponse_getAllOperations(){if(this.response.operations.operation)return this.response.operations.operation;else return null}function LASGetOperationsResponse_getOperationCount(){if(this.getAllOperations())return this.getAllOperations().length;else return-1}function LASGetOperationsResponse_getOperation(i){if(i>=0&&i<this.getOperationCount())return this.getAllOperations()[i];else return null}
function LASGetOperationsResponse_getOperationID(i){if(this.getOperation(i))return this.getOperation(i).ID;else return null}function LASGetOperationsResponse_getOperationByID(id){for(var i=0;i<this.getOperationCount();i++)if(this.getOperation(i).ID==id)return this.getOperation(i);return null}function LASGetOperationsResponse_getOperationName(i){if(this.getOperation(i))return this.getOperation(i).name;else return null};function LASGetOptionsResponse(JSONObject){this.response=JSONObject;if(!this.response)return false;this.getAllOptions=LASGetOptionsResponse_getAllOptions;this.getOptionCount=LASGetOptionsResponse_getOptionCount;this.getOption=LASGetOptionsResponse_getOption;this.getOptionID=LASGetOptionsResponse_getOptionID;this.getOptionByID=LASGetOptionsResponse_getOptionByID;this.getOptionName=LASGetOptionsResponse_getOptionName;this.getOptionType=LASGetOptionsResponse_getOptionType}
function LASGetOptionsResponse_getAllOptions(){if(this.response.options.option)return this.response.options.option;else return null}function LASGetOptionsResponse_getOptionCount(){if(this.getAllOptions())return this.getAllOptions().length;else return-1}function LASGetOptionsResponse_getOption(i){if(i>=0&&i<this.getOptionCount())return this.getAllOptions()[i];else return null}function LASGetOptionsResponse_getOptionID(i){if(this.getOption(i))return this.getOption(i).ID;else return null}
function LASGetOptionsResponse_getOptionByID(id){for(var i=0;i<this.getOptionCount();i++)if(this.getOption(i).ID==id)return this.getOption(i);return null}function LASGetOptionsResponse_getOptionName(i){if(this.getOption(i))return this.getOption(i).title;else return null}function LASGetOptionsResponse_getOptionType(i){if(this.getOption(i).menu)return"menu";else if(this.getOption(i).textfield)return"text";else return null};function Querystring(qs){this.params=new Object;this.get=Querystring_get;if(qs==null)qs=location.search.substring(1,location.search.length);if(qs.length==0)return;qs=qs.replace(/\+/g," ");var args=qs.split("&");for(var i=0;i<args.length;i++){var value;var pair=args[i].split("=");var name=unescape(pair[0]);if(pair.length==2)value=unescape(pair[1]);else value=name;this.params[name]=value}}
function Querystring_get(key,default_){if(default_==null)default_=null;var value=this.params[key];if(value==null)value=default_;return value};function DateWidget(lo,hi,deltaMinutes,offsetMinutes,add_sub_1,add_sub_2){this.setCallback=DateWidget_setCallback;this.render=DateWidget_render;this.renderToNode=DateWidget_renderToNode;this.disable=DateWidget_disable;this.enable=DateWidget_enable;this.show=DateWidget_show;this.hide=DateWidget_hide;this.getValue=DateWidget_getValue;this.setValue=DateWidget_setValue;this.initializeYearMenu=DateWidget_initializeYearMenu;this.setDateRange=DateWidget_setDateRange;this.setDate1=DateWidget_setDate1;this.setDate2=
DateWidget_setDate2;this.resetDateRange=DateWidget_resetDateRange;this.resetDate1=DateWidget_resetDate1;this.resetDate2=DateWidget_resetDate2;this.toString=DateWidget_toString;this.getDateLo=DateWidget_getDateLo;this.getDateHi=DateWidget_getDateHi;this.getDate1=DateWidget_getDate1;this.getDate2=DateWidget_getDate2;this.alert=DateWidget_alert;this.setDeltaMinutes=DateWidget_setDeltaMinutes;this.setOffsetMinutes=DateWidget_setOffsetMinutes;this.getDate1_Ferret=DateWidget_getDate1_Ferret;this.getDate2_Ferret=
DateWidget_getDate2_Ferret;this.parseDate=DateWidget_parseDate;this.febDays=DateWidget_febDays;this.twoDigit=DateWidget_twoDigit;this.fourDigit=DateWidget_fourDigit;this.correctOrder=DateWidget_correctOrder;this.addEvent=DateWidget_addEvent;this.flash=DateWidget_flash;this.selectYear=DateWidget_selectYear;this.selectMonth=DateWidget_selectMonth;this.selectDay=DateWidget_selectDay;this.selectTime=DateWidget_selectTime;this.selectChange=DateWidget_selectChange;this.widgetType="DateWidget";this.climatology=
0;this.disabled=0;this.visible=0;this.deltaMinutes=deltaMinutes?deltaMinutes:1440;this.offsetMinutes=offsetMinutes?offsetMinutes:0;var date1,date2,error_msg;try{date1=this.parseDate(lo,add_sub_1)}catch(error){error_msg='DateWidget ERROR: new:  error parsing "'+lo+'"\n'+error;alert(error_msg)}try{date2=this.parseDate(hi,add_sub_2)}catch(error){error_msg='DateWidget ERROR: new:  error parsing "'+hi+'"\n'+error;alert(error_msg)}this.yearLo=date1[0];this.monthLo=date1[1];this.dayLo=date1[2];this.hourLo=
date1[3];this.minuteLo=date1[4];this.secondLo=date1[5];this.yearHi=date2[0];this.monthHi=date2[1];this.dayHi=date2[2];this.hourHi=date2[3];this.minuteHi=date2[4];this.secondHi=date2[5];this.year1=this.yearLo;this.month1=this.monthLo;this.day1=this.dayLo;this.hour1=this.hourLo;this.minute1=this.minuteLo;this.second1=this.secondLo;this.year2=this.yearHi;this.month2=this.monthHi;this.day2=this.dayHi;this.hour2=this.hourHi;this.minute2=this.minuteHi;this.second2=this.secondHi}
function DateWidget_renderToNode(node,menu_set_1,menu_set_2){this.node=node;this.menu_set_1=menu_set_1;this.menu_set_2=menu_set_2;var children=node.childNodes;var num_children=children.length;for(var i=num_children-1;i>=0;i--){var child=children[i];if(child)node.removeChild(child)}var Text1,Year1,Month1,Day1,Time1;var Text2,Year2,Month2,Day2,Time2;var climatology_1=0;var climatology_2=0;if(!menu_set_1){error_msg='DateWidget ERROR:  render: menu_set_1 must be defined and  must contain only characters from "YMDT"';
throw error_msg;}Year1=document.createElement("select");Year1.setAttribute("id","DW_Year1");Year1.widget=this;this.Year1=Year1;if(menu_set_1.indexOf("Y")<0){this.Year1.style.display="none";climatology_1=1;this.climatology=1;text1=document.createTextNode("Climatology:  ");Text1=document.createElement("span");Text1.setAttribute("id","DW_Text1");Text1.appendChild(text1);Text1.widget=this;this.Text1=Text1}Month1=document.createElement("select");Month1.setAttribute("id","DW_Month1");Month1.widget=this;
this.Month1=Month1;if(menu_set_1.indexOf("M")<0)this.Month1.style.display="none";Day1=document.createElement("select");Day1.setAttribute("id","DW_Day1");Day1.widget=this;this.Day1=Day1;if(menu_set_1.indexOf("D")<0)this.Day1.style.display="none";Time1=document.createElement("select");Time1.setAttribute("id","DW_Time1");Time1.widget=this;this.Time1=Time1;if(menu_set_1.indexOf("T")<0)this.Time1.style.display="none";if(menu_set_2){Year2=document.createElement("select");Year2.setAttribute("id","DW_Year2");
Year2.widget=this;this.Year2=Year2;if(menu_set_2.indexOf("Y")<0){this.Year2.style.display="none";climatology_2=1;text2=document.createTextNode("Climatology:  ");Text2=document.createElement("span");Text2.setAttribute("id","DW_Text2");Text2.appendChild(text2);Text2.widget=this;this.Text2=Text2}Month2=document.createElement("select");Month2.setAttribute("id","DW_Month2");Month2.widget=this;this.Month2=Month2;if(menu_set_2.indexOf("M")<0)this.Month2.style.display="none";Day2=document.createElement("select");
Day2.setAttribute("id","DW_Day2");Day2.widget=this;this.Day2=Day2;if(menu_set_2.indexOf("D")<0)this.Day2.style.display="none";Time2=document.createElement("select");Time2.setAttribute("id","DW_Time2");Time2.widget=this;this.Time2=Time2;if(menu_set_2.indexOf("T")<0)this.Time2.style.display="none";if(climatology_1!=climatology_2){error_msg='DateWidget ERROR:  render: menu_set_1 "'+menu_set_1+'" and menu_set_2 "'+menu_set_2+'" must both include or both exclude the "Y" flag in the menu_set';throw error_msg;
}}var DW_table,DW_tr1,DW_td1,DW_tr2,DW_td2;DW_table=document.createElement("table");DW_table.setAttribute("id","DW_table");DW_tbody=document.createElement("tbody");DW_tbody.setAttribute("id","DW_tbody");DW_tr1=document.createElement("tr");DW_tr1.setAttribute("id","DW_tr1");DW_td1=document.createElement("td");DW_td1.setAttribute("id","DW_td1");DW_table.appendChild(DW_tbody);DW_tbody.appendChild(DW_tr1);DW_tr1.appendChild(DW_td1);if(Year1.style.display=="none"){DW_td1.appendChild(Year1);DW_td1.appendChild(Text1)}if(Month1.style.display==
"none")DW_td1.appendChild(Month1);if(Day1.style.display=="none")DW_td1.appendChild(Day1);if(Time1.style.display=="none")DW_td1.appendChild(Time1);for(i=0;i<menu_set_1.length;i++)switch(menu_set_1.charAt(i)){case "Y":DW_td1.appendChild(Year1);break;case "M":DW_td1.appendChild(Month1);break;case "D":DW_td1.appendChild(Day1);break;case "T":DW_td1.appendChild(Time1);break;default:error_msg='DateWidget ERROR:  render: menu_set "'+menu_set_1+'" must contain only characters from "YMDT"';throw error_msg;
break}if(menu_set_2){DW_tr2=document.createElement("tr");DW_tr2.setAttribute("id","DW_tr2");DW_td2=document.createElement("td");DW_td2.setAttribute("id","DW_td2");DW_tbody.appendChild(DW_tr2);DW_tr2.appendChild(DW_td2);if(Year2.style.display=="none"){DW_td2.appendChild(Year2);DW_td2.appendChild(Text2)}if(Month2.style.display=="none")DW_td2.appendChild(Month2);if(Day2.style.display=="none")DW_td2.appendChild(Day2);if(Time2.style.display=="none")DW_td2.appendChild(Time2);for(i=0;i<menu_set_2.length;i++)switch(menu_set_2.charAt(i)){case "Y":DW_td2.appendChild(Year2);
break;case "M":DW_td2.appendChild(Month2);break;case "D":DW_td2.appendChild(Day2);break;case "T":DW_td2.appendChild(Time2);break;default:error_msg='DateWidget ERROR:  render: menu_set "'+menu_set_2+'" must contain only characters from "YMDT"';throw error_msg;break}}node.appendChild(DW_table);this.initializeYearMenu(Year1);if(menu_set_2)this.initializeYearMenu(Year2);this.visible=1}
function DateWidget_render(element_id,menu_set_1,menu_set_2){this.element_id=element_id;this.menu_set_1=menu_set_1;this.menu_set_2=menu_set_2;var node=document.getElementById(this.element_id);var children=node.childNodes;var num_children=children.length;for(var i=num_children-1;i>=0;i--){var child=children[i];if(child)node.removeChild(child)}var Text1,Year1,Month1,Day1,Time1;var Text2,Year2,Month2,Day2,Time2;var climatology_1=0;var climatology_2=0;if(!menu_set_1){error_msg='DateWidget ERROR:  render: menu_set_1 must be defined and  must contain only characters from "YMDT"';
throw error_msg;}Year1=document.createElement("select");Year1.setAttribute("id","DW_Year1");Year1.widget=this;this.Year1=Year1;if(menu_set_1.indexOf("Y")<0){this.Year1.style.display="none";climatology_1=1;this.climatology=1;text1=document.createTextNode("Climatology:  ");Text1=document.createElement("span");Text1.setAttribute("id","DW_Text1");Text1.appendChild(text1);Text1.widget=this;this.Text1=Text1}Month1=document.createElement("select");Month1.setAttribute("id","DW_Month1");Month1.widget=this;
this.Month1=Month1;if(menu_set_1.indexOf("M")<0)this.Month1.style.display="none";Day1=document.createElement("select");Day1.setAttribute("id","DW_Day1");Day1.widget=this;this.Day1=Day1;if(menu_set_1.indexOf("D")<0)this.Day1.style.display="none";Time1=document.createElement("select");Time1.setAttribute("id","DW_Time1");Time1.widget=this;this.Time1=Time1;if(menu_set_1.indexOf("T")<0)this.Time1.style.display="none";if(menu_set_2){Year2=document.createElement("select");Year2.setAttribute("id","DW_Year2");
Year2.widget=this;this.Year2=Year2;if(menu_set_2.indexOf("Y")<0){this.Year2.style.display="none";climatology_2=1;text2=document.createTextNode("Climatology:  ");Text2=document.createElement("span");Text2.setAttribute("id","DW_Text2");Text2.appendChild(text2);Text2.widget=this;this.Text2=Text2}Month2=document.createElement("select");Month2.setAttribute("id","DW_Month2");Month2.widget=this;this.Month2=Month2;if(menu_set_2.indexOf("M")<0)this.Month2.style.display="none";Day2=document.createElement("select");
Day2.setAttribute("id","DW_Day2");Day2.widget=this;this.Day2=Day2;if(menu_set_2.indexOf("D")<0)this.Day2.style.display="none";Time2=document.createElement("select");Time2.setAttribute("id","DW_Time2");Time2.widget=this;this.Time2=Time2;if(menu_set_2.indexOf("T")<0)this.Time2.style.display="none";if(climatology_1!=climatology_2){error_msg='DateWidget ERROR:  render: menu_set_1 "'+menu_set_1+'" and menu_set_2 "'+menu_set_2+'" must both include or both exclude the "Y" flag in the menu_set';throw error_msg;
}}var DW_table,DW_tr1,DW_td1,DW_tr2,DW_td2;DW_table=document.createElement("table");DW_table.setAttribute("id","DW_table");DW_tbody=document.createElement("tbody");DW_tbody.setAttribute("id","DW_tbody");DW_tr1=document.createElement("tr");DW_tr1.setAttribute("id","DW_tr1");DW_td1=document.createElement("td");DW_td1.setAttribute("id","DW_td1");DW_table.appendChild(DW_tbody);DW_tbody.appendChild(DW_tr1);DW_tr1.appendChild(DW_td1);if(Year1.style.display=="none"){DW_td1.appendChild(Year1);DW_td1.appendChild(Text1)}if(Month1.style.display==
"none")DW_td1.appendChild(Month1);if(Day1.style.display=="none")DW_td1.appendChild(Day1);if(Time1.style.display=="none")DW_td1.appendChild(Time1);for(i=0;i<menu_set_1.length;i++)switch(menu_set_1.charAt(i)){case "Y":DW_td1.appendChild(Year1);break;case "M":DW_td1.appendChild(Month1);break;case "D":DW_td1.appendChild(Day1);break;case "T":DW_td1.appendChild(Time1);break;default:error_msg='DateWidget ERROR:  render: menu_set "'+menu_set_1+'" must contain only characters from "YMDT"';throw error_msg;
break}if(menu_set_2){DW_tr2=document.createElement("tr");DW_tr2.setAttribute("id","DW_tr2");DW_td2=document.createElement("td");DW_td2.setAttribute("id","DW_td2");DW_tbody.appendChild(DW_tr2);DW_tr2.appendChild(DW_td2);if(Year2.style.display=="none"){DW_td2.appendChild(Year2);DW_td2.appendChild(Text2)}if(Month2.style.display=="none")DW_td2.appendChild(Month2);if(Day2.style.display=="none")DW_td2.appendChild(Day2);if(Time2.style.display=="none")DW_td2.appendChild(Time2);for(i=0;i<menu_set_2.length;i++)switch(menu_set_2.charAt(i)){case "Y":DW_td2.appendChild(Year2);
break;case "M":DW_td2.appendChild(Month2);break;case "D":DW_td2.appendChild(Day2);break;case "T":DW_td2.appendChild(Time2);break;default:error_msg='DateWidget ERROR:  render: menu_set "'+menu_set_2+'" must contain only characters from "YMDT"';throw error_msg;break}}node.appendChild(DW_table);this.initializeYearMenu(Year1);if(menu_set_2)this.initializeYearMenu(Year2);this.visible=1}
function DateWidget_initializeYearMenu(YearMenu){var loYear;var hiYear;var currentYear;if(YearMenu.getAttribute("id")=="DW_Year1"){loYear=this.yearLo;hiYear=this.yearHi;if(this.year1>this.year2){currentYear=this.year2;this.flash(YearMenu)}else currentYear=this.year1}else{loYear=this.yearLo;hiYear=this.yearHi;if(this.year1>this.year2){currentYear=this.year1;this.flash(YearMenu)}else currentYear=this.year2}var n=hiYear-loYear+1;var y=loYear;with(YearMenu){options.length=0;for(i=0;i<n;i++){options[i]=
new Option(y,y);y++}if(this.initializing){this.internallyForced=1;if(name=="Year1")options[0].selected=true;else options[length-1].selected=true;this.initializing=0}else{y=loYear;for(i=0;i<n;i++){if(y==currentYear)options[i].selected=true;y++}}}YearMenu.onchange=this.selectChange;this.selectYear(YearMenu)}function DateWidget_setDateRange(String1,String2,add_sub_1,add_sub_2){this.resetDateRange();this.setDate1(String1,add_sub_1);this.setDate2(String2,add_sub_2)}
function DateWidget_setDate1(String1,add_sub_1){var date1=this.parseDate(String1,add_sub_1);this.year1=date1[0];this.month1=date1[1];this.day1=date1[2];this.hour1=date1[3];this.minute1=date1[4];this.second1=date1[5];if(!this.climatology)this.initializeYearMenu(this.Year1);else if(this.Month1)this.selectMonth(this.Month1)}
function DateWidget_setDate2(String2,add_sub_2){var date2=this.parseDate(String2,add_sub_2);this.year2=date2[0];this.month2=date2[1];this.day2=date2[2];this.hour2=date2[3];this.minute2=date2[4];this.second2=date2[5];if(this.Year2)this.initializeYearMenu(this.Year2);else if(this.Month2)this.selectMonth(this.Month2)}
function DateWidget_toString(){var message="dateLo = "+this.getDateLo()+"\n"+"dateHi = "+this.getDateHi()+"\n"+"date1 = "+this.getDate1()+"\n"+"date2 = "+this.getDate2()+"\n"+"this.deltaMinutes = "+this.deltaMinutes+"\n"+"this.offsetMinutes = "+this.offsetMinutes+"\n";return message}
function DateWidget_getDateLo(){var monthLo=this.monthLo=="00"?"":"-"+this.monthLo;var dayLo=this.dayLo=="00"?"":"-"+this.dayLo;var timeLo=this.Time1?" "+this.twoDigit(this.hourLo)+":"+this.twoDigit(this.minuteLo)+":"+this.twoDigit(this.secondLo):"";var message=this.fourDigit(this.yearLo)+monthLo+dayLo+timeLo;return message}
function DateWidget_getDateHi(){var monthHi=this.monthHi=="00"?"":"-"+this.monthHi;var dayHi=this.dayHi=="00"?"":"-"+this.dayHi;var timeHi=this.Time2?" "+this.twoDigit(this.hourHi)+":"+this.twoDigit(this.minuteHi)+":"+this.twoDigit(this.secondHi):"";var message=this.fourDigit(this.yearHi)+monthHi+dayHi+timeHi;return message}
function DateWidget_getDate1(){var month1=this.month1=="00"?"":"-"+this.month1;var day1=this.day1=="00"?"":"-"+this.day1;var time1=this.Time1?" "+this.twoDigit(this.hour1)+":"+this.twoDigit(this.minute1)+":"+this.twoDigit(this.second1):"";var message=this.fourDigit(this.year1)+month1+day1+time1;return message}
function DateWidget_getDate2(){var month2=this.month2=="00"?"":"-"+this.month2;var day2=this.day2=="00"?"":"-"+this.day2;var time2=this.Time2?" "+this.twoDigit(this.hour2)+":"+this.twoDigit(this.minute2)+":"+this.twoDigit(this.second2):"";var message=this.Year2?this.fourDigit(this.year2)+month2+day2+time2:"";return message}
function DateWidget_getDate1_Ferret(){var monthNames=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");var month1=this.month1=="00"?"":"-"+monthNames[Number(this.month1)-1];var day1=this.day1=="00"?"":this.day1;var time1=this.Time1?" "+this.twoDigit(this.hour1)+":"+this.twoDigit(this.minute1)+":"+this.twoDigit(this.second1):"";var message=day1+month1+"-"+this.fourDigit(this.year1);return message}
function DateWidget_getDate2_Ferret(){var monthNames=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");var month2=this.month2=="00"?"":"-"+monthNames[Number(this.month2)-1];var day2=this.day2=="00"?"":this.day2;var time2=this.Time2?" "+this.twoDigit(this.hour2)+":"+this.twoDigit(this.minute2)+":"+this.twoDigit(this.second2):"";var message=day2+month2+"-"+this.fourDigit(this.year2);return message}
function DateWidget_getValue(){var result=this.getDate1_Ferret();if(this.menu_set_2)result=result+","+this.getDate2_Ferret();return result}function DateWidget_setValue(value,index){var index=index?index:1;if(index==1)this.setDate1(value);else this.setDate2(value)}function DateWidget_alert(){alert(this.toString())}function DateWidget_resetDate1(){this.setDate1(this.getDateLo())}function DateWidget_resetDate2(){this.setDate2(this.getDateHi())}
function DateWidget_resetDateRange(){this.resetDate1();this.resetDate2()}function DateWidget_setDeltaMinutes(min){this.deltaMinutes=min}function DateWidget_setOffsetMinutes(min){this.offsetMinutes=min}
function DateWidget_disable(hilo){var node=document.getElementById(this.element_id);var select_nodes=node.getElementsByTagName("select");for(var i=0;i<select_nodes.length;i++)switch(hilo){case "hi":if(select_nodes[i].id[select_nodes[i].id.length-1]=="2")select_nodes[i].disabled=1;else break;case "lo":if(select_nodes[i].id[select_nodes[i].id.length-1]=="1")select_nodes[i].disabled=1;break;default:select_nodes[i].disabled=1}this.disabled=1}
function DateWidget_enable(hilo){var node=document.getElementById(this.element_id);var select_nodes=node.getElementsByTagName("select");for(var i=0;i<select_nodes.length;i++)switch(hilo){case "hi":if(select_nodes[i].id[select_nodes[i].id.length-1]=="2")select_nodes[i].disabled=0;else break;case "lo":if(select_nodes[i].id[select_nodes[i].id.length-1]=="1")select_nodes[i].disabled=0;break;default:select_nodes[i].disabled=0}this.disabled=0}
function DateWidget_show(){var node=document.getElementById(this.element_id);node.style.visibility="visible";this.visible=1}function DateWidget_hide(){var node=document.getElementById(this.element_id);node.style.visibility="hidden";this.visible=0}function DateWidget_setCallback(callback){this.callback=callback}
function DateWidget_parseDate(dateString,add_sub){var YMDHMS;var milli;var date=new Date;var newDate=new Date;switch(dateString){case "NOW":break;case "TODAY":var dummy=new Date;date=new Date(dummy.getFullYear(),dummy.getMonth(),dummy.getDate(),0,0,0);newDate=new Date(dummy.getFullYear(),dummy.getMonth(),dummy.getDate(),0,0,0);break;default:var dateTime=String(dateString).split(" ");var YMD=String(dateTime[0]).split("-");var YMDHMS=String(dateTime[0]).split("-");if(String(YMD[1]).length==3){var months=
{jan:"01",feb:"02",mar:"03",apr:"04",may:"05",jun:"06",jul:"07",aug:"08",sep:"09",oct:"10",nov:"11",dec:"12"};var mon=String(YMD[1].toLowerCase());var MM=months[mon];if(YMD[2])YMDHMS[0]=YMD[2];else YMDHMS[0]="0001";YMDHMS[1]=MM;YMDHMS[2]=YMD[0]}if(YMDHMS[0]){if(Number(YMDHMS[0]).valueOf()>=8E3){error_msg='The DateWidget cannot handle years >= 8000.  Incoming date is "'+dateString+'"';throw error_msg;}var year=Number(YMDHMS[0]).valueOf();if(year<100){year+=8E3;YMDHMS[0]=String(year)}var in_year=Number(YMDHMS[0]);
var Safari_date=new Date(in_year,1,1);var Safari_year=Safari_date.getFullYear();if(Safari_year!=in_year){if(in_year>8E3)in_year-=8E3;error_msg='Browser Issue!  Some browsers, eg Safari, only support years within the restricted range of "1902" to "2037".  Incoming year is "'+in_year+'".'}}else error_msg='DateWidget ERROR:  parseDate: bad date "'+dateString+'"';if(dateTime[1]){var HMS=String(dateTime[1]).split(":");YMDHMS[3]=HMS[0];YMDHMS[4]=HMS[1];YMDHMS[5]=HMS[2]}else{YMDHMS[3]="00";YMDHMS[4]="00";
YMDHMS[5]="00"}var error_msg;if(Number(YMDHMS[1]).valueOf()<1||Number(YMDHMS[1]).valueOf()>12){error_msg='DateWidget ERROR:  parseDate:  month "'+YMDHMS[1]+'" must be in the range 1:12';throw error_msg;}if(Number(YMDHMS[2]).valueOf()<1||Number(YMDHMS[2]).valueOf()>31){error_msg='DateWidget ERROR:  parseDate:  day "'+YMDHMS[2]+'" must be in the range 1:31';throw error_msg;}if(Number(YMDHMS[3]).valueOf()<0||Number(YMDHMS[3]).valueOf()>23){error_msg='DateWidget ERROR:  parseDate:  hour "'+YMDHMS[3]+
'" must be in the range 0:23';throw error_msg;}if(Number(YMDHMS[4]).valueOf()<0||Number(YMDHMS[4]).valueOf()>59){error_msg='DateWidget ERROR:  parseDate:  minute "'+YMDHMS[4]+'" must be in the range 0:59';throw error_msg;}if(Number(YMDHMS[5]).valueOf()<0||Number(YMDHMS[5]).valueOf()>59){error_msg='DateWidget ERROR:  parseDate:  second "'+YMDHMS[5]+'" must be in the range 0:59';throw error_msg;}date=new Date(YMDHMS[0],YMDHMS[1]-1,YMDHMS[2],YMDHMS[3],YMDHMS[4],YMDHMS[5]);newDate=new Date(YMDHMS[0],
YMDHMS[1]-1,YMDHMS[2],YMDHMS[3],YMDHMS[4],YMDHMS[5]);break}if(add_sub){milli=date.valueOf()+60*1E3*add_sub;newDate=new Date(milli)}with(newDate)YMDHMS=new Array(getFullYear(),getMonth()+1,getDate(),getHours(),getMinutes(),getSeconds());YMDHMS[5]=0;if(YMDHMS[0]>=8E3)YMDHMS[0]-=8E3;return YMDHMS}function DateWidget_febDays(year){var febDays=28;if(year%4==0){febDays=29;if(year%100==0){febDays=28;if(year%400==0)febDays=29}}return febDays}
function DateWidget_twoDigit(num){if(String(num).length==1)num="0"+String(num);return num}function DateWidget_fourDigit(num){while(String(num).length<4)num="0"+String(num);return num}function DateWidget_correctOrder(){var order=1;if(this.year1>this.year2)order=0;else if(this.year1==this.year2)if(this.month1>this.month2)order=0;else if(this.month1==this.month2)if(this.day1>this.day2)order=0;else if(this.day1==this.day2)if(this.hour1>this.hour2)order=0;return order}
function DateWidget_addEvent(elm,evType,fn,useCapture){if(elm.addEventListener){elm.addEventListener(evType,fn,useCapture);return true}else if(elm.attachEvent){var r=elm.attachEvent("on"+evType,fn);return r}else elm["on"+evType]=fn}function DateWidget_flash(Menu){var name=Menu.id;var command="document.getElementById('"+name+"').style.backgroundColor = '#fff'";Menu.style.backgroundColor="#fcc";window.setTimeout(command,750)}
function DateWidget_selectYear(YearMenu){var monthNames=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");var monthVals=new Array("01","02","03","04","05","06","07","08","09","10","11","12");currentYear=YearMenu.options[YearMenu.selectedIndex].value;var currentMonth;var MonthMenu;if(YearMenu.getAttribute("id")=="DW_Year1"){MonthMenu=this.Month1;this.year1=currentYear;if(this.year1==this.year2&&this.month1>this.month2){currentMonth=this.month2-1;this.flash(MonthMenu)}else currentMonth=
this.month1-1}else{MonthMenu=this.Month2;this.year2=currentYear;if(this.year1==this.year2&&this.month1>this.month2){currentMonth=this.month1-1;this.flash(MonthMenu)}else currentMonth=this.month2-1}var loMonth=0;var hiMonth=11;var OtherYearMenu;if(YearMenu.getAttribute("id")=="DW_Year1"){OtherYearMenu=this.Year2;if(currentYear==this.yearLo)loMonth=this.monthLo-1;if(currentYear==this.yearHi)hiMonth=this.monthHi-1}else{OtherYearMenu=this.Year1;if(currentYear==this.yearLo)loMonth=this.monthLo-1;if(currentYear==
this.yearHi)hiMonth=this.monthHi-1}if(MonthMenu){with(MonthMenu){var n=hiMonth-loMonth;var m=loMonth;options.length=0;if(this.monthLo!="00"){for(i=0;i<=n;i++){options[i]=new Option(monthNames[m],monthVals[m]);m++}if(currentMonth<loMonth||currentMonth>hiMonth)if(currentMonth<loMonth)options[0].selected=true;else{var i=hiMonth-loMonth;if(options[i])options[i].selected=true}else{var i=currentMonth-loMonth;if(options[i])options[i].selected=true}}}MonthMenu.onchange=this.selectChange;this.selectMonth(MonthMenu)}else if(this.internallyForced)this.internallyForced=
0;else if(OtherYearMenu)if(!this.correctOrder()){this.internallyForced=1;this.initializeYearMenu(OtherYearMenu)}}
function DateWidget_selectMonth(MonthMenu){var currentYear;var currentMonth;var currentDay;var DayMenu;var OtherYearMenu;var dayVals=new Array("01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31");if(this.monthLo=="00")currentMonth="00";else currentMonth=MonthMenu.options[MonthMenu.selectedIndex].value;if(MonthMenu.getAttribute("id")=="DW_Month1"){OtherYearMenu=this.Year2;DayMenu=this.Day1;currentYear=
this.year1;this.month1=currentMonth;if(this.year1==this.year2&&this.month1==this.month2&&this.day1>this.day2){currentDay=this.day2;this.flash(DayMenu)}else currentDay=this.day1}else{OtherYearMenu=this.Year1;DayMenu=this.Day2;currentYear=this.year2;this.month2=currentMonth;if(this.year1==this.year2&&this.month1==this.month2&&this.day1>this.day2){currentDay=this.day1;this.flash(DayMenu)}else currentDay=this.day2}var loDay=1;var hiDay=31;switch(currentMonth){case "02":hiDay=this.febDays(currentYear);
break;case "04":hiDay=30;break;case "06":hiDay=30;break;case "09":hiDay=30;break;case "11":hiDay=30;break;default:hiDay=31;break}if(MonthMenu.getAttribute("id")=="DW_Month1"){if(currentYear==this.yearLo&&currentMonth==this.monthLo)loDay=this.dayLo;if(currentYear==this.yearHi&&currentMonth==this.monthHi)hiDay=this.dayHi}else{if(currentYear==this.yearLo&&currentMonth==this.monthLo)loDay=this.dayLo;if(currentYear==this.yearHi&&currentMonth==this.monthHi)hiDay=this.dayHi}if(DayMenu){with(DayMenu){var n=
hiDay-loDay+1;var d=loDay-1;options.length=0;if(this.dayLo!="00"){for(i=0;i<n;i++){options[i]=new Option(dayVals[d],dayVals[d]);d++}if(currentDay<loDay||currentDay>hiDay){if(currentDay<loDay)options[0].selected=true;else{var i=hiDay-loDay;options[i].selected=true}this.flash(DayMenu)}else{var i=currentDay-loDay;options[i].selected=true}}}DayMenu.onchange=this.selectChange;this.selectDay(DayMenu)}else if(this.internallyForced)this.internallyForced=0;else if(OtherYearMenu)if(!this.correctOrder()){this.internallyForced=
1;this.initializeYearMenu(OtherYearMenu)}}
function DateWidget_selectDay(DayMenu){var currentYear;var currentMonth;var currentDay;var currentHour;var TimeMenu;var OtherYearMenu;if(this.dayLo=="00")currentDay="00";else currentDay=DayMenu.options[DayMenu.selectedIndex].value;if(DayMenu.getAttribute("id")=="DW_Day1"){this.day1=currentDay;TimeMenu=this.Time1;OtherYearMenu=this.Year2;currentYear=this.year1;currentMonth=this.month1;currentDay=this.day1;currentTime=this.hour1+":"+this.minute1}else{this.day2=currentDay;TimeMenu=this.Time2;OtherYearMenu=
this.Year1;currentYear=this.year2;currentMonth=this.month2;currentDay=this.day2;currentTime=this.hour2+":"+this.minute2}var loMinute=this.offsetMinutes;var hiMinute=1440;if(currentYear==this.yearLo&&currentMonth==this.monthLo&&currentDay==this.dayLo)loMinute=Number(this.minuteLo)+Number(this.hourLo)*60;if(currentYear==this.yearHi&&currentMonth==this.monthHi&&currentDay==this.dayHi)hiMinute=Number(this.minuteHi)+Number(this.hourHi)*60;if(TimeMenu){with(TimeMenu){var time="00:00";var hr=Math.floor(loMinute/
60);var min=loMinute-hr*60;var minutes=loMinute;var n=Math.floor((hiMinute-loMinute)/this.deltaMinutes)+1;for(i=0;i<n;i++){time=this.twoDigit(hr)+":"+this.twoDigit(min);options[i]=new Option(time,time);var tmp=String(currentTime).split(":");if(tmp[0]==hr&&tmp[1]==min)options[i].selected=true;minutes=Number(minutes)+Number(this.deltaMinutes);hr=Math.floor(minutes/60);min=minutes-hr*60;if(hr>=24)break}}TimeMenu.onchange=this.selectChange}if(this.internallyForced)this.internallyForced=0;else if(OtherYearMenu)if(!this.correctOrder()){this.internallyForced=
1;this.initializeYearMenu(OtherYearMenu)}}function DateWidget_selectTime(TimeMenu){var time=TimeMenu.options[TimeMenu.selectedIndex].value;var Time=String(time).split(":");if(TimeMenu.getAttribute("id")=="DW_Time1"){this.hour1=Time[0];this.minute1=Time[1]}else{this.hour2=Time[0];this.minute2=Time[1]}}
function DateWidget_selectChange(e){var target;if(window.event&&window.event.srcElement)target=window.event.srcElement;else if(e&&e.target)target=e.target;else{alert("DateWidget ERROR:\n> selectChange:  This browser does not support standard javascript events.");return}if(target.nodeName.toLowerCase()!="select"){alert("DateWidget ERROR:\n> selectChange:  event target ["+target.nodeName.toLowerCase()+"] should instead be [select]");return}var select=target;var DW=select.widget;switch(select.getAttribute("id")){case "DW_Year1":DW.selectYear(select);
break;case "DW_Month1":DW.selectMonth(select);break;case "DW_Day1":DW.selectDay(select);break;case "DW_Time1":DW.selectTime(select);break;case "DW_Year2":DW.selectYear(select);break;case "DW_Month2":DW.selectMonth(select);break;case "DW_Day2":DW.selectDay(select);break;case "DW_Time2":DW.selectTime(select);break}if(DW.callback)DW.callback(DW)};
